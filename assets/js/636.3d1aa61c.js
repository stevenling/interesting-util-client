"use strict";(self["webpackChunkinteresting_util_client"]=self["webpackChunkinteresting_util_client"]||[]).push([[636],{655:function(e,t,l){var o=l(6955),n=String;e.exports=function(e){if("Symbol"===o(e))throw new TypeError("Cannot convert a Symbol value to a string");return n(e)}},1108:function(e,t,l){var o=l(6955);e.exports=function(e){var t=o(e);return"BigInt64Array"===t||"BigUint64Array"===t}},1548:function(e,t,l){var o=l(4576),n=l(9039),a=l(9519),r=l(4215),i=o.structuredClone;e.exports=!!i&&!n(function(){if("DENO"===r&&a>92||"NODE"===r&&a>94||"BROWSER"===r&&a>97)return!1;var e=new ArrayBuffer(8),t=i(e,{transfer:[e]});return 0!==e.byteLength||8!==t.byteLength})},2603:function(e,t,l){var o=l(655);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:o(e)}},2967:function(e,t,l){var o=l(6706),n=l(34),a=l(7750),r=l(3506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,l={};try{e=o(Object.prototype,"__proto__","set"),e(l,[]),t=l instanceof Array}catch(i){}return function(l,o){return a(l),r(o),n(l)?(t?e(l,o):l.__proto__=o,l):l}}():void 0)},3167:function(e,t,l){var o=l(4901),n=l(34),a=l(2967);e.exports=function(e,t,l){var r,i;return a&&o(r=t.constructor)&&r!==l&&n(i=r.prototype)&&i!==l.prototype&&a(e,i),e}},3238:function(e,t,l){var o=l(4576),n=l(7811),a=l(7394),r=o.DataView;e.exports=function(e){if(!n||0!==a(e))return!1;try{return new r(e),!1}catch(t){return!0}}},3506:function(e,t,l){var o=l(3925),n=String,a=TypeError;e.exports=function(e){if(o(e))return e;throw new a("Can't set "+n(e)+" as a prototype")}},3925:function(e,t,l){var o=l(34);e.exports=function(e){return o(e)||null===e}},4215:function(e,t,l){var o=l(4576),n=l(2839),a=l(2195),r=function(e){return n.slice(0,e.length)===e};e.exports=function(){return r("Bun/")?"BUN":r("Cloudflare-Workers")?"CLOUDFLARE":r("Deno/")?"DENO":r("Node.js/")?"NODE":o.Bun&&"string"==typeof Bun.version?"BUN":o.Deno&&"object"==typeof Deno.version?"DENO":"process"===a(o.process)?"NODE":o.window&&o.document?"BROWSER":"REST"}()},4483:function(e,t,l){var o,n,a,r,i=l(4576),u=l(9429),s=l(1548),c=i.structuredClone,f=i.ArrayBuffer,v=i.MessageChannel,d=!1;if(s)d=function(e){c(e,{transfer:[e]})};else if(f)try{v||(o=u("worker_threads"),o&&(v=o.MessageChannel)),v&&(n=new v,a=new f(2),r=function(e){n.port1.postMessage(null,[e])},2===a.byteLength&&(r(a),0===a.byteLength&&(d=r)))}catch(p){}e.exports=d},4644:function(e,t,l){var o,n,a,r=l(7811),i=l(3724),u=l(4576),s=l(4901),c=l(34),f=l(9297),v=l(6955),d=l(6823),p=l(6699),g=l(6840),y=l(2106),m=l(1625),b=l(2787),h=l(2967),w=l(8227),k=l(3392),_=l(1181),x=_.enforce,E=_.get,R=u.Int8Array,A=R&&R.prototype,C=u.Uint8ClampedArray,T=C&&C.prototype,L=R&&b(R),F=A&&b(A),S=Object.prototype,I=u.TypeError,D=w("toStringTag"),B=k("TYPED_ARRAY_TAG"),z="TypedArrayConstructor",O=r&&!!h&&"Opera"!==v(u.opera),M=!1,N={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},K={BigInt64Array:8,BigUint64Array:8},U=function(e){if(!c(e))return!1;var t=v(e);return"DataView"===t||f(N,t)||f(K,t)},V=function(e){var t=b(e);if(c(t)){var l=E(t);return l&&f(l,z)?l[z]:V(t)}},$=function(e){if(!c(e))return!1;var t=v(e);return f(N,t)||f(K,t)},W=function(e){if($(e))return e;throw new I("Target is not a typed array")},H=function(e){if(s(e)&&(!h||m(L,e)))return e;throw new I(d(e)+" is not a typed array constructor")},Y=function(e,t,l,o){if(i){if(l)for(var n in N){var a=u[n];if(a&&f(a.prototype,e))try{delete a.prototype[e]}catch(r){try{a.prototype[e]=t}catch(s){}}}F[e]&&!l||g(F,e,l?t:O&&A[e]||t,o)}},P=function(e,t,l){var o,n;if(i){if(h){if(l)for(o in N)if(n=u[o],n&&f(n,e))try{delete n[e]}catch(a){}if(L[e]&&!l)return;try{return g(L,e,l?t:O&&L[e]||t)}catch(a){}}for(o in N)n=u[o],!n||n[e]&&!l||g(n,e,t)}};for(o in N)n=u[o],a=n&&n.prototype,a?x(a)[z]=n:O=!1;for(o in K)n=u[o],a=n&&n.prototype,a&&(x(a)[z]=n);if((!O||!s(L)||L===Function.prototype)&&(L=function(){throw new I("Incorrect invocation")},O))for(o in N)u[o]&&h(u[o],L);if((!O||!F||F===S)&&(F=L.prototype,O))for(o in N)u[o]&&h(u[o].prototype,F);if(O&&b(T)!==F&&h(T,F),i&&!f(F,D))for(o in M=!0,y(F,D,{configurable:!0,get:function(){return c(this)?this[B]:void 0}}),N)u[o]&&p(u[o],B,o);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:O,TYPED_ARRAY_TAG:M&&B,aTypedArray:W,aTypedArrayConstructor:H,exportTypedArrayMethod:Y,exportTypedArrayStaticMethod:P,getTypedArrayConstructor:V,isView:U,isTypedArray:$,TypedArray:L,TypedArrayPrototype:F}},4979:function(e,t,l){var o=l(6518),n=l(4576),a=l(7751),r=l(6980),i=l(4913).f,u=l(9297),s=l(679),c=l(3167),f=l(2603),v=l(5002),d=l(8574),p=l(3724),g=l(6395),y="DOMException",m=a("Error"),b=a(y),h=function(){s(this,w);var e=arguments.length,t=f(e<1?void 0:arguments[0]),l=f(e<2?void 0:arguments[1],"Error"),o=new b(t,l),n=new m(t);return n.name=y,i(o,"stack",r(1,d(n.stack,1))),c(o,this,h),o},w=h.prototype=b.prototype,k="stack"in new m(y),_="stack"in new b(1,2),x=b&&p&&Object.getOwnPropertyDescriptor(n,y),E=!!x&&!(x.writable&&x.configurable),R=k&&!E&&!_;o({global:!0,constructor:!0,forced:g||R},{DOMException:R?h:b});var A=a(y),C=A.prototype;if(C.constructor!==A)for(var T in g||i(C,"constructor",r(1,A)),v)if(u(v,T)){var L=v[T],F=L.s;u(A,F)||i(A,F,r(6,L.c))}},5002:function(e){e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},5169:function(e,t,l){var o=l(3238),n=TypeError;e.exports=function(e){if(o(e))throw new n("ArrayBuffer is detached");return e}},5636:function(e,t,l){var o=l(4576),n=l(9504),a=l(6706),r=l(7696),i=l(5169),u=l(7394),s=l(4483),c=l(1548),f=o.structuredClone,v=o.ArrayBuffer,d=o.DataView,p=Math.min,g=v.prototype,y=d.prototype,m=n(g.slice),b=a(g,"resizable","get"),h=a(g,"maxByteLength","get"),w=n(y.getInt8),k=n(y.setInt8);e.exports=(c||s)&&function(e,t,l){var o,n=u(e),a=void 0===t?n:r(t),g=!b||!b(e);if(i(e),c&&(e=f(e,{transfer:[e]}),n===a&&(l||g)))return e;if(n>=a&&(!l||g))o=m(e,0,a);else{var y=l&&!g&&h?{maxByteLength:h(e)}:void 0;o=new v(a,y);for(var _=new d(e),x=new d(o),E=p(a,n),R=0;R<E;R++)k(x,R,w(_,R))}return c||s(e),o}},5854:function(e,t,l){var o=l(2777),n=TypeError;e.exports=function(e){var t=o(e,"number");if("number"==typeof t)throw new n("Can't convert number to bigint");return BigInt(t)}},6193:function(e,t,l){var o=l(4215);e.exports="NODE"===o},6573:function(e,t,l){var o=l(3724),n=l(2106),a=l(3238),r=ArrayBuffer.prototype;o&&!("detached"in r)&&n(r,"detached",{configurable:!0,get:function(){return a(this)}})},6706:function(e,t,l){var o=l(9504),n=l(9306);e.exports=function(e,t,l){try{return o(n(Object.getOwnPropertyDescriptor(e,t)[l]))}catch(a){}}},7394:function(e,t,l){var o=l(4576),n=l(6706),a=l(2195),r=o.ArrayBuffer,i=o.TypeError;e.exports=r&&n(r.prototype,"byteLength","get")||function(e){if("ArrayBuffer"!==a(e))throw new i("ArrayBuffer expected");return e.byteLength}},7696:function(e,t,l){var o=l(1291),n=l(8014),a=RangeError;e.exports=function(e){if(void 0===e)return 0;var t=o(e),l=n(t);if(t!==l)throw new a("Wrong length or index");return l}},7811:function(e){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},7936:function(e,t,l){var o=l(6518),n=l(5636);n&&o({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return n(this,arguments.length?arguments[0]:void 0,!1)}})},8100:function(e,t,l){var o=l(6518),n=l(5636);n&&o({target:"ArrayBuffer",proto:!0},{transfer:function(){return n(this,arguments.length?arguments[0]:void 0,!0)}})},8574:function(e,t,l){var o=l(9504),n=Error,a=o("".replace),r=function(e){return String(new n(e).stack)}("zxcasd"),i=/\n\s*at [^:]*:[^\n]*/,u=i.test(r);e.exports=function(e,t){if(u&&"string"==typeof e&&!n.prepareStackTrace)while(t--)e=a(e,i,"");return e}},8636:function(e,t,l){l.r(t),l.d(t,{default:function(){return V}});l(4114),l(6573),l(8100),l(7936),l(8111),l(7588),l(9577),l(4979);var o=l(641),n=l(953),a=l(33),r=l(163),i=l(8548),u=l(5638);const s={class:"epub-reader"},c={class:"reader-container"},f={key:0,class:"upload-section"},v={class:"upload-card"},d={key:1,class:"reading-section"},p={class:"content-area"},g={key:0,class:"toc-sidebar"},y={class:"toc-list"},m=["onClick"],b={key:1,class:"settings-sidebar"},h={class:"setting-group"},w={class:"setting-group"},k={class:"font-size-controls"},_={class:"font-size-display"},x={class:"setting-group"},E={class:"tooltip-content"},R={class:"tooltip-actions"},A={class:"right-toolbar"},C={class:"book-info"},T={key:0},L={class:"page-info"},F={class:"controls"},S={style:{display:"flex"}},I={style:{flex:"1","min-width":"0",display:"flex","align-items":"center","justify-content":"center"}},D={style:{height:"700px","overflow-y":"auto",width:"100%",display:"flex","align-items":"center","justify-content":"center"}},B={style:{width:"100px","margin-left":"12px",display:"flex","flex-direction":"column",gap:"12px",height:"100%","box-sizing":"border-box"}},z={style:{display:"flex","align-items":"center",gap:"4px"}},O={style:{"min-width":"32px","text-align":"center"}},M=4718592;var N={__name:"EpubReader",setup(e){const t=(0,n.KR)(null),N=(0,n.KR)(""),K=(0,n.KR)(""),U=(0,n.KR)(1),V=(0,n.KR)(1),$=(0,n.KR)(""),W=(0,n.KR)(!1),H=(0,n.KR)([]),Y=(0,n.KR)(null),P=(0,n.KR)(null),X=(0,n.KR)(16),j=(0,n.KR)("Arial"),Q=(0,n.KR)("#ffffff"),q=(0,n.KR)(!1),G=(0,n.KR)([]),Z=(0,n.KR)(!1),J=(0,n.KR)(""),ee=(0,n.KR)("#ffeb3b"),te=(0,n.KR)(""),le=(0,n.KR)(0),oe=(0,n.KR)(0),ne=(0,n.KR)({left:"0px",top:"0px",position:"absolute"}),ae=[{label:"白色",value:"#ffffff"},{label:"米色",value:"#f5f5dc"},{label:"浅灰",value:"#f8f8f8"},{label:"浅黄",value:"#fefefe"},{label:"护眼绿",value:"#c7edcc"},{label:"夜间模式",value:"#2c2c2c"},{label:"浅蓝",value:"#eaf4ff"},{label:"浅粉",value:"#fff0f6"},{label:"浅紫",value:"#f3e8ff"},{label:"暗夜蓝",value:"#232946"},{label:"暖米黄",value:"#fdf6e3"},{label:"暖灰",value:"#ececec"},{label:"蓝紫渐变",value:"linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)"}],re={"#ffffff":"#222","#f5f5dc":"#222","#f8f8f8":"#222","#fefefe":"#222","#c7edcc":"#222","#eaf4ff":"#222","#fff0f6":"#8e4a6b","#f3e8ff":"#6b4a8e","#ececec":"#222","#fdf6e3":"#6b4e16","#2c2c2c":"#fff","#232946":"#fff","linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)":"#222"},ie=(0,o.EW)(()=>re[Q.value]||"#222");let ue=null,se=null;const ce=(0,n.KR)(""),fe=(0,n.KR)(26),ve=[{label:"Arial",value:"Arial"},{label:"Times New Roman",value:"Times New Roman"},{label:"微软雅黑",value:"Microsoft YaHei"},{label:"楷体",value:"KaiTi"},{label:"宋体",value:"SimSun"},{label:"黑体",value:"SimHei"},{label:"JetBrains Mono",value:"JetBrains Mono"},{label:"Fira Code",value:"Fira Code"},{label:"Georgia",value:"Georgia"},{label:"Verdana",value:"Verdana"},{label:"Helvetica",value:"Helvetica"}];function de(e){let t="";const l=new Uint8Array(e),o=l.byteLength;for(let n=0;n<o;n++)t+=String.fromCharCode(l[n]);return btoa(t)}const pe=()=>{const e=localStorage.getItem("epub-book-base64");if(e){const t=atob(e),l=t.length,o=new Uint8Array(l);for(let e=0;e<l;e++)o[e]=t.charCodeAt(e);ye(o.buffer)}};(0,o.sV)(()=>{pe()});const ge=e=>{if("application/epub+zip"!==e.raw.type&&!e.raw.name.endsWith(".epub"))return void r.nk.error("请上传有效的EPUB文件");if(e.raw.size>M){r.nk.error("文件过大，无法自动保存到本地。请上传小于4.5MB的EPUB文件。");const t=new FileReader;return t.onload=e=>{ye(e.target.result)},void t.readAsArrayBuffer(e.raw)}const t=new FileReader;t.onload=e=>{const t=e.target.result,l=de(t);try{localStorage.setItem("epub-book-base64",l)}catch(e){r.nk.warning("文件过大，未能保存到本地，下次需重新上传。")}ye(t)},t.readAsArrayBuffer(e.raw)},ye=async e=>{try{console.log("开始加载EPUB文件..."),ue&&(ue.destroy(),ue=null),console.log("导入epubjs...");const n=await l.e(432).then(l.bind(l,6432));console.log("epubjs导入成功:",n);const a=n.default||n.Book||n;console.log("使用Book构造函数:",a),console.log("创建Book实例..."),se=new a(e),console.log("Book实例创建成功"),console.log("等待Book ready..."),await se.ready,console.log("Book ready完成"),console.log("获取书籍信息...");const i=await se.loaded.metadata;N.value=i.title||"未知标题",K.value=i.creator||"",console.log("书籍信息:",i),console.log("获取目录...");const u=await se.loaded.navigation;if(H.value=u.toc||[],console.log("目录数据:",u),console.log("设置book状态..."),t.value=se,console.log("book状态已设置:",t.value),console.log("等待DOM更新..."),await(0,o.dY)(),console.log("DOM更新完成"),await new Promise(e=>setTimeout(e,100)),console.log("检查viewer元素:",P.value),console.log("viewerElement类型:",typeof P.value),console.log("viewerElement是否为HTMLElement:",P.value instanceof HTMLElement),!P.value)throw new Error("Viewer element not found - DOM可能还没有完全渲染");P.value.innerHTML="",console.log("viewer元素已清空"),console.log("初始化渲染器..."),ue=se.renderTo(P.value,{width:"100%",height:"100%",flow:"scrolled-doc",manager:"continuous"}),ue.themes.default({body:{"font-family":j.value,"font-size":`${X.value}px`,"background-color":Q.value},p:{"font-family":j.value,"font-size":`${X.value}px`},div:{"font-family":j.value,"font-size":`${X.value}px`},span:{"font-family":j.value,"font-size":`${X.value}px`}}),ue.themes.register("background",Q.value),ue.themes.select("background",Q.value),console.log("显示内容..."),await ue.display(),setTimeout(()=>{ke()},200),we(),Ce();const s=await se.spine;V.value=s.length,U.value=1,console.log("初始化页码:",U.value,"总页数:",V.value),setTimeout(()=>{Ce()},500),r.nk.success("书籍加载成功！")}catch(n){console.error("加载书籍失败:",n),console.error("错误堆栈:",n.stack),r.nk.error(`加载书籍失败: ${n.message}`),ue&&(ue.destroy(),ue=null),se=null}},me=()=>{console.log("点击上一页，当前页码:",U.value),ue&&U.value>1?(ue.prev(),setTimeout(()=>{U.value=Math.max(1,U.value-1),console.log("上一页后页码:",U.value)},100)):console.log("上一页按钮被禁用，当前页码:",U.value)},be=()=>{console.log("点击下一页，当前页码:",U.value,"总页数:",V.value),ue&&U.value<V.value?(ue.next(),setTimeout(()=>{U.value=Math.min(V.value,U.value+1),console.log("下一页后页码:",U.value)},100)):console.log("下一页按钮被禁用，当前页码:",U.value,"总页数:",V.value)},he=e=>{ue&&(ue.display(e),W.value=!1,U.value=1)},we=()=>{ue&&(ue.on("relocated",e=>{if(console.log("页面变化:",e),e&&e.start&&e.start.location){const t=e.start.location;U.value=t>0?t:1,console.log("relocated事件更新页码为:",U.value)}else U.value=Math.max(1,U.value),console.log("relocated事件使用默认页码:",U.value)}),ue.on("rendered",e=>{console.log("页面渲染完成:",e),U.value<=0&&(U.value=1,console.log("rendered事件修正页码为:",U.value))}),setTimeout(()=>{U.value<=0&&(U.value=1,console.log("初始化修正页码为:",U.value))},200))},ke=()=>{if(ue&&P.value){const e=P.value.querySelector("iframe");if(e&&e.contentDocument){const t=e.contentDocument.querySelectorAll("style[data-epub-reader]");t.forEach(e=>e.remove());const l=e.contentDocument.createElement("style");l.setAttribute("data-epub-reader","true"),l.textContent=`\n        body {\n          background-color: ${Q.value} !important;\n          font-family: ${j.value} !important;\n          font-size: ${X.value}px !important;\n          line-height: 1.6 !important;\n          color: ${ie.value} !important;\n        }\n        p, div, span, h1, h2, h3, h4, h5, h6 {\n          font-family: ${j.value} !important;\n          font-size: ${X.value}px !important;\n          color: ${ie.value} !important;\n        }\n        * {\n          font-family: ${j.value} !important;\n        }\n      `,e.contentDocument.head.appendChild(l)}}},_e=()=>{if(ue){console.log("更新字体:",j.value);const e=ue.location;ue.themes.default({body:{"font-family":j.value,"font-size":`${X.value}px`,"background-color":Q.value},p:{"font-family":j.value,"font-size":`${X.value}px`},div:{"font-family":j.value,"font-size":`${X.value}px`},span:{"font-family":j.value,"font-size":`${X.value}px`}}),ue.themes.select("default"),e&&ue.display(e.start.href),setTimeout(()=>{ke()},100)}},xe=()=>{X.value<24&&(X.value+=2,console.log("增加字体大小到:",X.value),Re())},Ee=()=>{X.value>12&&(X.value-=2,console.log("减少字体大小到:",X.value),Re())},Re=()=>{if(ue){console.log("更新字体大小:",X.value);const e=ue.location;ue.themes.default({body:{"font-family":j.value,"font-size":`${X.value}px`,"background-color":Q.value},p:{"font-family":j.value,"font-size":`${X.value}px`},div:{"font-family":j.value,"font-size":`${X.value}px`},span:{"font-family":j.value,"font-size":`${X.value}px`}}),ue.themes.select("default"),e&&ue.display(e.start.href),setTimeout(()=>{ke()},100)}},Ae=()=>{if(ue){console.log("更新背景:",Q.value);const e=ue.location;ue.themes.default({body:{"font-family":j.value,"font-size":`${X.value}px`,"background-color":Q.value},p:{"font-family":j.value,"font-size":`${X.value}px`},div:{"font-family":j.value,"font-size":`${X.value}px`},span:{"font-family":j.value,"font-size":`${X.value}px`}}),ue.themes.select("default"),P.value&&(P.value.style.backgroundColor=Q.value),e&&ue.display(e.start.href),setTimeout(()=>{ke()},100)}},Ce=()=>{console.log("设置文本选择功能"),ue&&ue.on("selected",async function(e){console.log("epub.js selected事件触发:",e);try{te.value=e;const t=await se.getRange(e);if(t){const e=t.toString().trim();console.log("选中的文本:",e),e&&(J.value=e,console.log("当前选中内容:",J.value),Ne())}}catch(t){console.error("获取选中文本失败:",t)}}),document.addEventListener("selectionchange",()=>{console.log("选择变化事件触发");const e=window.getSelection();if(console.log("当前选择对象:",e),e&&e.toString().trim()){const t=e.toString().trim();console.log("选中的文本:",t),J.value=t,console.log("当前选中内容:",J.value),Ne()}}),document.addEventListener("mouseup",e=>{console.log("鼠标抬起事件"),le.value=e.screenX,oe.value=e.screenY,setTimeout(()=>{const e=window.getSelection();if(e&&e.toString().trim()){const t=e.toString().trim();console.log("鼠标选择文本:",t),J.value=t,console.log("当前选中内容:",J.value),Ne()}},100)}),document.addEventListener("mousemove",e=>{le.value=e.screenX,oe.value=e.screenY})},Te=(0,n.KR)(!1),Le=(0,n.KR)(""),Fe=(0,n.KR)(ae[0].value),Se=(0,n.KR)(ve[0].value),Ie=(0,n.KR)(ie.value),De=async()=>{const e=document.getElementById("export-preview-area");if(!e)return;ce.value=J.value;const t=e.style.maxHeight,o=e.style.overflowY,n=e.style.width;e.style.maxHeight="none",e.style.overflowY="visible",e.style.width="600px",e.scrollTop=0;try{const t=await l.e(354).then(l.t.bind(l,354,23)),o=await t.default(e,{scale:3,backgroundColor:null,width:600,height:e.scrollHeight}),n=await new Promise(e=>o.toBlob(e));await navigator.clipboard.write([new window.ClipboardItem({[n.type]:n})]),r.nk.success("图片已复制到剪贴板！")}catch(a){r.nk.error("复制失败，可能浏览器不支持或未授权")}finally{e.style.maxHeight=t,e.style.overflowY=o,e.style.width=n}};(0,o.wB)(Te,e=>{e&&(Fe.value=ae[0].value,Se.value=ve[0].value,Ie.value=ie.value,Be())}),(0,o.wB)([Fe,Se,Ie,fe,ce],()=>{Te.value&&Be()});const Be=async()=>{if(!ce.value)return;const e=await l.e(354).then(l.t.bind(l,354,23)),t=3,o=420,n=document.createElement("div");n.style.cssText=`\n    position: fixed;\n    top: -9999px;\n    left: -9999px;\n    width: ${o}px;\n    height: 700px;\n    padding: 2.2rem 1.5rem 1.5rem 1.5rem;\n    background: ${Fe.value};\n    border-radius: 18px;\n    box-shadow: 0 4px 24px 0 rgba(0,0,0,0.10), 0 1.5px 4px 0 rgba(0,0,0,0.03);\n    font-family: ${Se.value}, 'FZKai-Z03', '楷体', 'STKaiti', '仿宋', serif;\n    font-size: ${fe.value}px;\n    color: ${Ie.value};\n    line-height: 2.2;\n    text-align: left;\n    z-index: -1;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: flex-start;\n    position: relative;\n    box-sizing: border-box;\n    overflow: hidden;\n  `;const a=document.createElement("div");a.innerHTML='<svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><text x="0" y="28" font-size="32" fill="#e6e6e6" font-family="serif">"</text></svg>',a.style.cssText="\n    position: absolute;\n    top: 1.1rem;\n    left: 1.2rem;\n    width: 36px;\n    height: 36px;\n    opacity: 1;\n    pointer-events: none;\n  ",n.appendChild(a);const r=document.createElement("div");r.style.cssText="\n    margin: 0.5rem 0 0.7rem 0;\n    font-weight: 500;\n    word-break: break-all;\n    white-space: pre-wrap;\n    min-height: 120px;\n    width: 100%;\n    text-align: left;\n    flex: 1;\n  ",r.textContent=ce.value;const i=document.createElement("div");i.style.cssText="\n    font-size: 0.98rem;\n    font-family: 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif;\n    opacity: 0.85;\n    margin-left: 0.1rem;\n    margin-bottom: 0.2rem;\n    text-align: right;\n    align-self: flex-end;\n    width: 100%;\n    margin-top: 1rem;\n    color: #7ca05b;\n  ",i.textContent=(new Date).toISOString().slice(0,10),n.appendChild(r),n.appendChild(i),document.body.appendChild(n);const u=n.offsetWidth,s=n.offsetHeight,c=await e.default(n,{scale:t,backgroundColor:null,width:u,height:s});document.body.removeChild(n),Le.value=c.toDataURL()},ze=async()=>{J.value&&(ce.value=J.value,Te.value=!0,r.nk.success("图片已生成，可预览和下载"))},Oe=()=>{if(J.value){const t={text:J.value,color:ee.value,timestamp:(new Date).toLocaleString(),id:`highlight_${Date.now()}`,cfiRange:te.value};if(G.value.push(t),te.value&&ue)try{ue.annotations.add("highlight",te.value,{color:ee.value}),console.log("添加epub.js高亮:",te.value)}catch(e){console.error("添加epub.js高亮失败:",e)}J.value="",te.value="",window.getSelection&&window.getSelection().removeAllRanges(),r.nk.success("划线添加成功！")}},Me=()=>{ue&&(ue.destroy(),ue=null),P.value&&(P.value.innerHTML=""),t.value=null,N.value="",K.value="",U.value=1,V.value=1,$.value="",W.value=!1,H.value=[],se=null,localStorage.removeItem("epub-book-base64")};(0,o.hi)(()=>{ue&&ue.destroy()});const Ne=async()=>{await(0,o.dY)();const e=window.getSelection(),t=document.querySelector(".tooltip-panel"),l=document.querySelector(".reader-view");if(e&&e.rangeCount>0&&t&&l){const o=e.getRangeAt(0),n=o.getBoundingClientRect(),a=l.getBoundingClientRect(),r=t.offsetWidth||320,i=t.offsetHeight||48,u=12;let s=n.left+n.width/2-r/2-a.left;const c=a.bottom-n.bottom;let f;f=c>i+u?n.bottom-a.top+u:n.top-a.top-i-u,s=Math.max(8,Math.min(s,a.width-r-8)),f=Math.max(8,Math.min(f,a.height-i-8)),ne.value={left:`${s}px`,top:`${f}px`,position:"absolute"}}};return(e,l)=>{const r=(0,o.g2)("el-icon"),M=(0,o.g2)("el-upload"),G=(0,o.g2)("el-option"),ee=(0,o.g2)("el-select"),te=(0,o.g2)("el-button"),le=(0,o.g2)("el-color-picker"),oe=(0,o.g2)("el-dialog");return(0,o.uX)(),(0,o.CE)("div",s,[(0,o.bF)(u.A),(0,o.Lk)("div",c,[t.value?((0,o.uX)(),(0,o.CE)("div",d,[(0,o.Lk)("div",p,[W.value?((0,o.uX)(),(0,o.CE)("div",g,[l[16]||(l[16]=(0,o.Lk)("h4",null,"目录",-1)),(0,o.Lk)("div",y,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(H.value,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:(0,a.C4)(["toc-item",{active:$.value===e.href}]),onClick:t=>he(e.href)},(0,a.v_)(e.label),11,m))),128))])])):(0,o.Q3)("",!0),q.value?((0,o.uX)(),(0,o.CE)("div",b,[l[22]||(l[22]=(0,o.Lk)("h4",null,"阅读设置",-1)),(0,o.Lk)("div",h,[l[17]||(l[17]=(0,o.Lk)("label",null,"字体：",-1)),(0,o.bF)(ee,{modelValue:j.value,"onUpdate:modelValue":l[0]||(l[0]=e=>j.value=e),onChange:_e,size:"small"},{default:(0,o.k6)(()=>[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(ve,e=>(0,o.bF)(G,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),(0,o.Lk)("div",w,[l[20]||(l[20]=(0,o.Lk)("label",null,"字体大小：",-1)),(0,o.Lk)("div",k,[(0,o.bF)(te,{onClick:Ee,size:"small"},{default:(0,o.k6)(()=>l[18]||(l[18]=[(0,o.eW)("A-",-1)])),_:1,__:[18]}),(0,o.Lk)("span",_,(0,a.v_)(X.value)+"px",1),(0,o.bF)(te,{onClick:xe,size:"small"},{default:(0,o.k6)(()=>l[19]||(l[19]=[(0,o.eW)("A+",-1)])),_:1,__:[19]})])]),(0,o.Lk)("div",x,[l[21]||(l[21]=(0,o.Lk)("label",null,"背景：",-1)),(0,o.bF)(ee,{modelValue:Q.value,"onUpdate:modelValue":l[1]||(l[1]=e=>Q.value=e),onChange:Ae,size:"small"},{default:(0,o.k6)(()=>[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(ae,e=>(0,o.bF)(G,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])])):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"reader-view",ref_key:"readerView",ref:Y},[(0,o.Lk)("div",{ref_key:"viewerElement",ref:P,class:"epub-viewer"},null,512),J.value?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"tooltip-panel",style:(0,a.Tr)(ne.value)},[(0,o.Lk)("div",E,[(0,o.Lk)("div",R,[(0,o.bF)(te,{onClick:Oe,type:"primary",size:"small"},{default:(0,o.k6)(()=>[(0,o.bF)(r,null,{default:(0,o.k6)(()=>[(0,o.bF)((0,n.R1)(i.Edit))]),_:1}),l[23]||(l[23]=(0,o.eW)(" 添加划线 ",-1))]),_:1,__:[23]}),(0,o.bF)(te,{onClick:ze,type:"success",size:"small"},{default:(0,o.k6)(()=>[(0,o.bF)(r,null,{default:(0,o.k6)(()=>l[24]||(l[24]=[(0,o.Lk)("picture",null,null,-1)])),_:1,__:[24]}),l[25]||(l[25]=(0,o.eW)(" 导出图片 ",-1))]),_:1,__:[25]})])]),l[26]||(l[26]=(0,o.Lk)("div",{class:"tooltip-arrow"},null,-1))],4)):(0,o.Q3)("",!0)],512),(0,o.Lk)("div",A,[(0,o.Lk)("div",C,[(0,o.Lk)("h3",null,(0,a.v_)(N.value),1),K.value?((0,o.uX)(),(0,o.CE)("p",T,"作者: "+(0,a.v_)(K.value),1)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",L,[(0,o.Lk)("span",null,(0,a.v_)(U.value)+" / "+(0,a.v_)(V.value),1)]),(0,o.Lk)("div",F,[(0,o.bF)(te,{onClick:me,disabled:U.value<=1,size:"small"},{default:(0,o.k6)(()=>[(0,o.bF)(r,null,{default:(0,o.k6)(()=>[(0,o.bF)((0,n.R1)(i.ArrowLeft))]),_:1}),l[27]||(l[27]=(0,o.eW)(" 上一页 ",-1))]),_:1,__:[27]},8,["disabled"]),(0,o.bF)(te,{onClick:be,disabled:U.value>=V.value,size:"small"},{default:(0,o.k6)(()=>[l[28]||(l[28]=(0,o.eW)(" 下一页 ",-1)),(0,o.bF)(r,null,{default:(0,o.k6)(()=>[(0,o.bF)((0,n.R1)(i.ArrowRight))]),_:1})]),_:1,__:[28]},8,["disabled"]),(0,o.bF)(te,{onClick:l[2]||(l[2]=e=>W.value=!W.value),size:"small"},{default:(0,o.k6)(()=>[(0,o.bF)(r,null,{default:(0,o.k6)(()=>l[29]||(l[29]=[(0,o.Lk)("menu",null,null,-1)])),_:1,__:[29]}),l[30]||(l[30]=(0,o.eW)(" 目录 ",-1))]),_:1,__:[30]}),(0,o.bF)(te,{onClick:l[3]||(l[3]=e=>q.value=!q.value),size:"small"},{default:(0,o.k6)(()=>[(0,o.bF)(r,null,{default:(0,o.k6)(()=>[(0,o.bF)((0,n.R1)(i.Setting))]),_:1}),l[31]||(l[31]=(0,o.eW)(" 设置 ",-1))]),_:1,__:[31]}),(0,o.bF)(te,{onClick:l[4]||(l[4]=e=>Z.value=!Z.value),size:"small"},{default:(0,o.k6)(()=>[(0,o.bF)(r,null,{default:(0,o.k6)(()=>[(0,o.bF)((0,n.R1)(i.Edit))]),_:1}),l[32]||(l[32]=(0,o.eW)(" 划线 ",-1))]),_:1,__:[32]}),(0,o.bF)(te,{onClick:Me,size:"small"},{default:(0,o.k6)(()=>[(0,o.bF)(r,null,{default:(0,o.k6)(()=>[(0,o.bF)((0,n.R1)(i.Refresh))]),_:1}),l[33]||(l[33]=(0,o.eW)(" 重新上传 ",-1))]),_:1,__:[33]})])])])])):((0,o.uX)(),(0,o.CE)("div",f,[(0,o.Lk)("div",v,[l[14]||(l[14]=(0,o.Lk)("h2",null,"EPUB 在线阅读器",-1)),l[15]||(l[15]=(0,o.Lk)("p",null,"上传您的EPUB文件开始阅读",-1)),(0,o.bF)(M,{class:"upload-area",drag:"",accept:".epub","auto-upload":!1,"show-file-list":!1,"on-change":ge},{tip:(0,o.k6)(()=>l[12]||(l[12]=[(0,o.Lk)("div",{class:"el-upload__tip"}," 只能上传 epub 文件 ",-1)])),default:(0,o.k6)(()=>[(0,o.bF)(r,{class:"el-icon--upload"},{default:(0,o.k6)(()=>[(0,o.bF)((0,n.R1)(i.UploadFilled))]),_:1}),l[13]||(l[13]=(0,o.Lk)("div",{class:"el-upload__text"},[(0,o.eW)(" 将文件拖到此处，或"),(0,o.Lk)("em",null,"点击上传")],-1))]),_:1,__:[13]})])]))]),(0,o.bF)(oe,{modelValue:Te.value,"onUpdate:modelValue":l[11]||(l[11]=e=>Te.value=e),title:"图片预览",width:"700px",center:""},{footer:(0,o.k6)(()=>[(0,o.bF)(te,{onClick:l[10]||(l[10]=e=>Te.value=!1)},{default:(0,o.k6)(()=>l[36]||(l[36]=[(0,o.eW)("关闭",-1)])),_:1,__:[36]}),(0,o.bF)(te,{type:"primary",onClick:De},{default:(0,o.k6)(()=>l[37]||(l[37]=[(0,o.eW)("复制图片",-1)])),_:1,__:[37]})]),default:(0,o.k6)(()=>[(0,o.Lk)("div",S,[(0,o.Lk)("div",I,[(0,o.Lk)("div",D,[(0,o.Lk)("div",{id:"export-preview-area",style:(0,a.Tr)({width:"420px",minHeight:"120px",maxHeight:"700px",background:Fe.value,color:Ie.value,fontFamily:Se.value,fontSize:fe.value+"px",borderRadius:"8px",padding:"2.2rem 1.5rem 1.5rem 1.5rem",boxShadow:"0 4px 24px 0 rgba(0,0,0,0.10), 0 1.5px 4px 0 rgba(0,0,0,0.03)",lineHeight:2.2,textAlign:"left",overflowY:"auto",wordBreak:"break-all",whiteSpace:"pre-wrap",display:"block",boxSizing:"border-box",userSelect:"auto",cursor:"text"})},(0,a.v_)(ce.value),5)])]),(0,o.Lk)("div",B,[(0,o.bF)(ee,{modelValue:Se.value,"onUpdate:modelValue":l[5]||(l[5]=e=>Se.value=e),placeholder:"字体",size:"small"},{default:(0,o.k6)(()=>[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(ve,e=>(0,o.bF)(G,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),(0,o.Lk)("div",z,[(0,o.bF)(te,{onClick:l[6]||(l[6]=e=>{fe.value=Math.max(12,fe.value-2),Be()}),size:"small"},{default:(0,o.k6)(()=>l[34]||(l[34]=[(0,o.eW)("A-",-1)])),_:1,__:[34]}),(0,o.Lk)("span",O,(0,a.v_)(fe.value)+"px",1),(0,o.bF)(te,{onClick:l[7]||(l[7]=e=>{fe.value=Math.min(36,fe.value+2),Be()}),size:"small"},{default:(0,o.k6)(()=>l[35]||(l[35]=[(0,o.eW)("A+",-1)])),_:1,__:[35]})]),(0,o.bF)(ee,{modelValue:Fe.value,"onUpdate:modelValue":l[8]||(l[8]=e=>Fe.value=e),placeholder:"背景",size:"small"},{default:(0,o.k6)(()=>[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(ae,e=>(0,o.bF)(G,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),(0,o.bF)(le,{modelValue:Ie.value,"onUpdate:modelValue":l[9]||(l[9]=e=>Ie.value=e),size:"small"},null,8,["modelValue"])])])]),_:1},8,["modelValue"])])}}},K=l(6262);const U=(0,K.A)(N,[["__scopeId","data-v-25e5c810"]]);var V=U},9429:function(e,t,l){var o=l(4576),n=l(6193);e.exports=function(e){if(n){try{return o.process.getBuiltinModule(e)}catch(t){}try{return Function('return require("'+e+'")')()}catch(t){}}}},9577:function(e,t,l){var o=l(9928),n=l(4644),a=l(1108),r=l(1291),i=l(5854),u=n.aTypedArray,s=n.getTypedArrayConstructor,c=n.exportTypedArrayMethod,f=function(){try{new Int8Array(1)["with"](2,{valueOf:function(){throw 8}})}catch(e){return 8===e}}(),v=f&&function(){try{new Int8Array(1)["with"](-.5,1)}catch(e){return!0}}();c("with",{with:function(e,t){var l=u(this),n=r(e),c=a(l)?i(t):+t;return o(l,s(l),n,c)}}["with"],!f||v)},9928:function(e,t,l){var o=l(6198),n=l(1291),a=RangeError;e.exports=function(e,t,l,r){var i=o(e),u=n(l),s=u<0?i+u:u;if(s>=i||s<0)throw new a("Incorrect index");for(var c=new t(i),f=0;f<i;f++)c[f]=f===s?r:e[f];return c}}}]);