"use strict";(self["webpackChunkinteresting_util_client"]=self["webpackChunkinteresting_util_client"]||[]).push([[636],{81:function(e,t,o){var n=o(9565),l=o(9306),r=o(8551),a=o(6823),i=o(851),u=TypeError;e.exports=function(e,t){var o=arguments.length<2?i(e):t;if(l(o))return r(n(o,e));throw new u(a(e)+" is not iterable")}},397:function(e,t,o){var n=o(7751);e.exports=n("document","documentElement")},655:function(e,t,o){var n=o(6955),l=String;e.exports=function(e){if("Symbol"===n(e))throw new TypeError("Cannot convert a Symbol value to a string");return l(e)}},679:function(e,t,o){var n=o(1625),l=TypeError;e.exports=function(e,t){if(n(t,e))return e;throw new l("Incorrect invocation")}},851:function(e,t,o){var n=o(6955),l=o(5966),r=o(4117),a=o(6269),i=o(8227),u=i("iterator");e.exports=function(e){if(!r(e))return l(e,u)||l(e,"@@iterator")||a[n(e)]}},1072:function(e,t,o){var n=o(1828),l=o(8727);e.exports=Object.keys||function(e){return n(e,l)}},1108:function(e,t,o){var n=o(6955);e.exports=function(e){var t=n(e);return"BigInt64Array"===t||"BigUint64Array"===t}},1767:function(e){e.exports=function(e){return{iterator:e,next:e.next,done:!1}}},2106:function(e,t,o){var n=o(283),l=o(4913);e.exports=function(e,t,o){return o.get&&n(o.get,t,{getter:!0}),o.set&&n(o.set,t,{setter:!0}),l.f(e,t,o)}},2140:function(e,t,o){var n=o(8227),l=n("toStringTag"),r={};r[l]="z",e.exports="[object z]"===String(r)},2211:function(e,t,o){var n=o(9039);e.exports=!n(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})},2360:function(e,t,o){var n,l=o(8551),r=o(6801),a=o(8727),i=o(421),u=o(397),c=o(4055),s=o(6119),f=">",v="<",d="prototype",p="script",y=s("IE_PROTO"),m=function(){},g=function(e){return v+p+f+e+v+"/"+p+f},b=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},h=function(){var e,t=c("iframe"),o="java"+p+":";return t.style.display="none",u.appendChild(t),t.src=String(o),e=t.contentWindow.document,e.open(),e.write(g("document.F=Object")),e.close(),e.F},w=function(){try{n=new ActiveXObject("htmlfile")}catch(t){}w="undefined"!=typeof document?document.domain&&n?b(n):h():b(n);var e=a.length;while(e--)delete w[d][a[e]];return w()};i[y]=!0,e.exports=Object.create||function(e,t){var o;return null!==e?(m[d]=l(e),o=new m,m[d]=null,o[y]=e):o=w(),void 0===t?o:r.f(o,t)}},2603:function(e,t,o){var n=o(655);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:n(e)}},2652:function(e,t,o){var n=o(6080),l=o(9565),r=o(8551),a=o(6823),i=o(4209),u=o(6198),c=o(1625),s=o(81),f=o(851),v=o(9539),d=TypeError,p=function(e,t){this.stopped=e,this.result=t},y=p.prototype;e.exports=function(e,t,o){var m,g,b,h,w,x,_,k=o&&o.that,E=!(!o||!o.AS_ENTRIES),R=!(!o||!o.IS_RECORD),A=!(!o||!o.IS_ITERATOR),T=!(!o||!o.INTERRUPTED),C=n(t,k),I=function(e){return m&&v(m,"normal"),new p(!0,e)},S=function(e){return E?(r(e),T?C(e[0],e[1],I):C(e[0],e[1])):T?C(e,I):C(e)};if(R)m=e.iterator;else if(A)m=e;else{if(g=f(e),!g)throw new d(a(e)+" is not iterable");if(i(g)){for(b=0,h=u(e);h>b;b++)if(w=S(e[b]),w&&c(y,w))return w;return new p(!1)}m=s(e,g)}x=R?e.next:m.next;while(!(_=l(x,m)).done){try{w=S(_.value)}catch(F){v(m,"throw",F)}if("object"==typeof w&&w&&c(y,w))return w}return new p(!1)}},2787:function(e,t,o){var n=o(9297),l=o(4901),r=o(8981),a=o(6119),i=o(2211),u=a("IE_PROTO"),c=Object,s=c.prototype;e.exports=i?c.getPrototypeOf:function(e){var t=r(e);if(n(t,u))return t[u];var o=t.constructor;return l(o)&&t instanceof o?o.prototype:t instanceof c?s:null}},2967:function(e,t,o){var n=o(6706),l=o(34),r=o(7750),a=o(3506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,o={};try{e=n(Object.prototype,"__proto__","set"),e(o,[]),t=o instanceof Array}catch(i){}return function(o,n){return r(o),a(n),l(o)?(t?e(o,n):o.__proto__=n,o):o}}():void 0)},3167:function(e,t,o){var n=o(4901),l=o(34),r=o(2967);e.exports=function(e,t,o){var a,i;return r&&n(a=t.constructor)&&a!==o&&l(i=a.prototype)&&i!==o.prototype&&r(e,i),e}},3506:function(e,t,o){var n=o(3925),l=String,r=TypeError;e.exports=function(e){if(n(e))return e;throw new r("Can't set "+l(e)+" as a prototype")}},3925:function(e,t,o){var n=o(34);e.exports=function(e){return n(e)||null===e}},4209:function(e,t,o){var n=o(8227),l=o(6269),r=n("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(l.Array===e||a[r]===e)}},4549:function(e,t,o){var n=o(4576);e.exports=function(e,t){var o=n.Iterator,l=o&&o.prototype,r=l&&l[e],a=!1;if(r)try{r.call({next:function(){return{done:!0}},return:function(){a=!0}},-1)}catch(i){i instanceof t||(a=!1)}if(!a)return r}},4644:function(e,t,o){var n,l,r,a=o(7811),i=o(3724),u=o(4576),c=o(4901),s=o(34),f=o(9297),v=o(6955),d=o(6823),p=o(6699),y=o(6840),m=o(2106),g=o(1625),b=o(2787),h=o(2967),w=o(8227),x=o(3392),_=o(1181),k=_.enforce,E=_.get,R=u.Int8Array,A=R&&R.prototype,T=u.Uint8ClampedArray,C=T&&T.prototype,I=R&&b(R),S=A&&b(A),F=Object.prototype,L=u.TypeError,O=w("toStringTag"),z=x("TYPED_ARRAY_TAG"),D="TypedArrayConstructor",M=a&&!!h&&"Opera"!==v(u.opera),K=!1,U={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},N={BigInt64Array:8,BigUint64Array:8},V=function(e){if(!s(e))return!1;var t=v(e);return"DataView"===t||f(U,t)||f(N,t)},B=function(e){var t=b(e);if(s(t)){var o=E(t);return o&&f(o,D)?o[D]:B(t)}},$=function(e){if(!s(e))return!1;var t=v(e);return f(U,t)||f(N,t)},j=function(e){if($(e))return e;throw new L("Target is not a typed array")},P=function(e){if(c(e)&&(!h||g(I,e)))return e;throw new L(d(e)+" is not a typed array constructor")},W=function(e,t,o,n){if(i){if(o)for(var l in U){var r=u[l];if(r&&f(r.prototype,e))try{delete r.prototype[e]}catch(a){try{r.prototype[e]=t}catch(c){}}}S[e]&&!o||y(S,e,o?t:M&&A[e]||t,n)}},H=function(e,t,o){var n,l;if(i){if(h){if(o)for(n in U)if(l=u[n],l&&f(l,e))try{delete l[e]}catch(r){}if(I[e]&&!o)return;try{return y(I,e,o?t:M&&I[e]||t)}catch(r){}}for(n in U)l=u[n],!l||l[e]&&!o||y(l,e,t)}};for(n in U)l=u[n],r=l&&l.prototype,r?k(r)[D]=l:M=!1;for(n in N)l=u[n],r=l&&l.prototype,r&&(k(r)[D]=l);if((!M||!c(I)||I===Function.prototype)&&(I=function(){throw new L("Incorrect invocation")},M))for(n in U)u[n]&&h(u[n],I);if((!M||!S||S===F)&&(S=I.prototype,M))for(n in U)u[n]&&h(u[n].prototype,S);if(M&&b(C)!==S&&h(C,S),i&&!f(S,O))for(n in K=!0,m(S,O,{configurable:!0,get:function(){return s(this)?this[z]:void 0}}),U)u[n]&&p(u[n],z,n);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:M,TYPED_ARRAY_TAG:K&&z,aTypedArray:j,aTypedArrayConstructor:P,exportTypedArrayMethod:W,exportTypedArrayStaticMethod:H,getTypedArrayConstructor:B,isView:V,isTypedArray:$,TypedArray:I,TypedArrayPrototype:S}},4659:function(e,t,o){var n=o(3724),l=o(4913),r=o(6980);e.exports=function(e,t,o){n?l.f(e,t,r(0,o)):e[t]=o}},4979:function(e,t,o){var n=o(6518),l=o(4576),r=o(7751),a=o(6980),i=o(4913).f,u=o(9297),c=o(679),s=o(3167),f=o(2603),v=o(5002),d=o(6193),p=o(3724),y=o(6395),m="DOMException",g=r("Error"),b=r(m),h=function(){c(this,w);var e=arguments.length,t=f(e<1?void 0:arguments[0]),o=f(e<2?void 0:arguments[1],"Error"),n=new b(t,o),l=new g(t);return l.name=m,i(n,"stack",a(1,d(l.stack,1))),s(n,this,h),n},w=h.prototype=b.prototype,x="stack"in new g(m),_="stack"in new b(1,2),k=b&&p&&Object.getOwnPropertyDescriptor(l,m),E=!!k&&!(k.writable&&k.configurable),R=x&&!E&&!_;n({global:!0,constructor:!0,forced:y||R},{DOMException:R?h:b});var A=r(m),T=A.prototype;if(T.constructor!==A)for(var C in y||i(T,"constructor",a(1,A)),v)if(u(v,C)){var I=v[C],S=I.s;u(A,S)||i(A,S,a(6,I.c))}},5002:function(e){e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},5854:function(e,t,o){var n=o(2777),l=TypeError;e.exports=function(e){var t=n(e,"number");if("number"==typeof t)throw new l("Can't convert number to bigint");return BigInt(t)}},6080:function(e,t,o){var n=o(7476),l=o(9306),r=o(616),a=n(n.bind);e.exports=function(e,t){return l(e),void 0===t?e:r?a(e,t):function(){return e.apply(t,arguments)}}},6193:function(e,t,o){var n=o(9504),l=Error,r=n("".replace),a=function(e){return String(new l(e).stack)}("zxcasd"),i=/\n\s*at [^:]*:[^\n]*/,u=i.test(a);e.exports=function(e,t){if(u&&"string"==typeof e&&!l.prepareStackTrace)while(t--)e=r(e,i,"");return e}},6269:function(e){e.exports={}},6706:function(e,t,o){var n=o(9504),l=o(9306);e.exports=function(e,t,o){try{return n(l(Object.getOwnPropertyDescriptor(e,t)[o]))}catch(r){}}},6801:function(e,t,o){var n=o(3724),l=o(8686),r=o(4913),a=o(8551),i=o(5397),u=o(1072);t.f=n&&!l?Object.defineProperties:function(e,t){a(e);var o,n=i(t),l=u(t),c=l.length,s=0;while(c>s)r.f(e,o=l[s++],n[o]);return e}},6955:function(e,t,o){var n=o(2140),l=o(4901),r=o(2195),a=o(8227),i=a("toStringTag"),u=Object,c="Arguments"===r(function(){return arguments}()),s=function(e,t){try{return e[t]}catch(o){}};e.exports=n?r:function(e){var t,o,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(o=s(t=u(e),i))?o:c?r(t):"Object"===(n=r(t))&&l(t.callee)?"Arguments":n}},7476:function(e,t,o){var n=o(2195),l=o(9504);e.exports=function(e){if("Function"===n(e))return l(e)}},7588:function(e,t,o){var n=o(6518),l=o(9565),r=o(2652),a=o(9306),i=o(8551),u=o(1767),c=o(9539),s=o(4549),f=s("forEach",TypeError);n({target:"Iterator",proto:!0,real:!0,forced:f},{forEach:function(e){i(this);try{a(e)}catch(n){c(this,"throw",n)}if(f)return l(f,this,e);var t=u(this),o=0;r(t,function(t){e(t,o++)},{IS_RECORD:!0})}})},7657:function(e,t,o){var n,l,r,a=o(9039),i=o(4901),u=o(34),c=o(2360),s=o(2787),f=o(6840),v=o(8227),d=o(6395),p=v("iterator"),y=!1;[].keys&&(r=[].keys(),"next"in r?(l=s(s(r)),l!==Object.prototype&&(n=l)):y=!0);var m=!u(n)||a(function(){var e={};return n[p].call(e)!==e});m?n={}:d&&(n=c(n)),i(n[p])||f(n,p,function(){return this}),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:y}},7811:function(e){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},8111:function(e,t,o){var n=o(6518),l=o(4576),r=o(679),a=o(8551),i=o(4901),u=o(2787),c=o(2106),s=o(4659),f=o(9039),v=o(9297),d=o(8227),p=o(7657).IteratorPrototype,y=o(3724),m=o(6395),g="constructor",b="Iterator",h=d("toStringTag"),w=TypeError,x=l[b],_=m||!i(x)||x.prototype!==p||!f(function(){x({})}),k=function(){if(r(this,p),u(this)===p)throw new w("Abstract class Iterator not directly constructable")},E=function(e,t){y?c(p,e,{configurable:!0,get:function(){return t},set:function(t){if(a(this),this===p)throw new w("You can't redefine this property");v(this,e)?this[e]=t:s(this,e,t)}}):p[e]=t};v(p,h)||E(h,b),!_&&v(p,g)&&p[g]!==Object||E(g,k),k.prototype=p,n({global:!0,constructor:!0,forced:_},{Iterator:k})},8636:function(e,t,o){o.r(t),o.d(t,{default:function(){return B}});o(4114),o(8111),o(7588),o(9577),o(4979);var n=o(641),l=o(953),r=o(33),a=o(163),i=o(8548),u=o(5638);const c={class:"epub-reader"},s={class:"reader-container"},f={key:0,class:"upload-section"},v={class:"upload-card"},d={key:1,class:"reading-section"},p={class:"content-area"},y={key:0,class:"toc-sidebar"},m={class:"toc-list"},g=["onClick"],b={key:1,class:"settings-sidebar"},h={class:"setting-group"},w={class:"setting-group"},x={class:"font-size-controls"},_={class:"font-size-display"},k={class:"setting-group"},E={class:"tooltip-content"},R={class:"tooltip-actions"},A={class:"right-toolbar"},T={class:"book-info"},C={key:0},I={class:"page-info"},S={class:"controls"},F={style:{display:"flex"}},L={style:{flex:"1","min-width":"0",display:"flex","align-items":"center","justify-content":"center"}},O={style:{height:"700px","overflow-y":"auto",width:"100%",display:"flex","align-items":"center","justify-content":"center"}},z={style:{width:"100px","margin-left":"12px",display:"flex","flex-direction":"column",gap:"12px",height:"100%","box-sizing":"border-box"}},D={style:{display:"flex","align-items":"center",gap:"4px"}},M={style:{"min-width":"32px","text-align":"center"}},K=4718592;var U={__name:"EpubReader",setup(e){const t=(0,l.KR)(null),U=(0,l.KR)(""),N=(0,l.KR)(""),V=(0,l.KR)(1),B=(0,l.KR)(1),$=(0,l.KR)(""),j=(0,l.KR)(!1),P=(0,l.KR)([]),W=(0,l.KR)(null),H=(0,l.KR)(null),Y=(0,l.KR)(16),X=(0,l.KR)("Arial"),G=(0,l.KR)("#ffffff"),Q=(0,l.KR)(!1),q=(0,l.KR)([]),Z=(0,l.KR)(!1),J=(0,l.KR)(""),ee=(0,l.KR)("#ffeb3b"),te=(0,l.KR)(""),oe=(0,l.KR)(0),ne=(0,l.KR)(0),le=(0,l.KR)({left:"0px",top:"0px",position:"absolute"}),re=[{label:"白色",value:"#ffffff"},{label:"米色",value:"#f5f5dc"},{label:"浅灰",value:"#f8f8f8"},{label:"浅黄",value:"#fefefe"},{label:"护眼绿",value:"#c7edcc"},{label:"夜间模式",value:"#2c2c2c"},{label:"浅蓝",value:"#eaf4ff"},{label:"浅粉",value:"#fff0f6"},{label:"浅紫",value:"#f3e8ff"},{label:"暗夜蓝",value:"#232946"},{label:"暖米黄",value:"#fdf6e3"},{label:"暖灰",value:"#ececec"},{label:"蓝紫渐变",value:"linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)"}],ae={"#ffffff":"#222","#f5f5dc":"#222","#f8f8f8":"#222","#fefefe":"#222","#c7edcc":"#222","#eaf4ff":"#222","#fff0f6":"#8e4a6b","#f3e8ff":"#6b4a8e","#ececec":"#222","#fdf6e3":"#6b4e16","#2c2c2c":"#fff","#232946":"#fff","linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)":"#222"},ie=(0,n.EW)(()=>ae[G.value]||"#222");let ue=null,ce=null;const se=(0,l.KR)(""),fe=(0,l.KR)(26),ve=[{label:"Arial",value:"Arial"},{label:"Times New Roman",value:"Times New Roman"},{label:"微软雅黑",value:"Microsoft YaHei"},{label:"楷体",value:"KaiTi"},{label:"宋体",value:"SimSun"},{label:"黑体",value:"SimHei"},{label:"JetBrains Mono",value:"JetBrains Mono"},{label:"Fira Code",value:"Fira Code"},{label:"Georgia",value:"Georgia"},{label:"Verdana",value:"Verdana"},{label:"Helvetica",value:"Helvetica"}];function de(e){let t="";const o=new Uint8Array(e),n=o.byteLength;for(let l=0;l<n;l++)t+=String.fromCharCode(o[l]);return btoa(t)}const pe=()=>{const e=localStorage.getItem("epub-book-base64");if(e){const t=atob(e),o=t.length,n=new Uint8Array(o);for(let e=0;e<o;e++)n[e]=t.charCodeAt(e);me(n.buffer)}};(0,n.sV)(()=>{pe()});const ye=e=>{if("application/epub+zip"!==e.raw.type&&!e.raw.name.endsWith(".epub"))return void a.nk.error("请上传有效的EPUB文件");if(e.raw.size>K){a.nk.error("文件过大，无法自动保存到本地。请上传小于4.5MB的EPUB文件。");const t=new FileReader;return t.onload=e=>{me(e.target.result)},void t.readAsArrayBuffer(e.raw)}const t=new FileReader;t.onload=e=>{const t=e.target.result,o=de(t);try{localStorage.setItem("epub-book-base64",o)}catch(e){a.nk.warning("文件过大，未能保存到本地，下次需重新上传。")}me(t)},t.readAsArrayBuffer(e.raw)},me=async e=>{try{console.log("开始加载EPUB文件..."),ue&&(ue.destroy(),ue=null),console.log("导入epubjs...");const l=await o.e(432).then(o.bind(o,6432));console.log("epubjs导入成功:",l);const r=l.default||l.Book||l;console.log("使用Book构造函数:",r),console.log("创建Book实例..."),ce=new r(e),console.log("Book实例创建成功"),console.log("等待Book ready..."),await ce.ready,console.log("Book ready完成"),console.log("获取书籍信息...");const i=await ce.loaded.metadata;U.value=i.title||"未知标题",N.value=i.creator||"",console.log("书籍信息:",i),console.log("获取目录...");const u=await ce.loaded.navigation;if(P.value=u.toc||[],console.log("目录数据:",u),console.log("设置book状态..."),t.value=ce,console.log("book状态已设置:",t.value),console.log("等待DOM更新..."),await(0,n.dY)(),console.log("DOM更新完成"),await new Promise(e=>setTimeout(e,100)),console.log("检查viewer元素:",H.value),console.log("viewerElement类型:",typeof H.value),console.log("viewerElement是否为HTMLElement:",H.value instanceof HTMLElement),!H.value)throw new Error("Viewer element not found - DOM可能还没有完全渲染");H.value.innerHTML="",console.log("viewer元素已清空"),console.log("初始化渲染器..."),ue=ce.renderTo(H.value,{width:"100%",height:"100%",flow:"scrolled-doc",manager:"continuous"}),ue.themes.default({body:{"font-family":X.value,"font-size":`${Y.value}px`,"background-color":G.value},p:{"font-family":X.value,"font-size":`${Y.value}px`},div:{"font-family":X.value,"font-size":`${Y.value}px`},span:{"font-family":X.value,"font-size":`${Y.value}px`}}),ue.themes.register("background",G.value),ue.themes.select("background",G.value),console.log("显示内容..."),await ue.display(),setTimeout(()=>{xe()},200),we(),Te();const c=await ce.spine;B.value=c.length,V.value=1,console.log("初始化页码:",V.value,"总页数:",B.value),setTimeout(()=>{Te()},500),a.nk.success("书籍加载成功！")}catch(l){console.error("加载书籍失败:",l),console.error("错误堆栈:",l.stack),a.nk.error(`加载书籍失败: ${l.message}`),ue&&(ue.destroy(),ue=null),ce=null}},ge=()=>{console.log("点击上一页，当前页码:",V.value),ue&&V.value>1?(ue.prev(),setTimeout(()=>{V.value=Math.max(1,V.value-1),console.log("上一页后页码:",V.value)},100)):console.log("上一页按钮被禁用，当前页码:",V.value)},be=()=>{console.log("点击下一页，当前页码:",V.value,"总页数:",B.value),ue&&V.value<B.value?(ue.next(),setTimeout(()=>{V.value=Math.min(B.value,V.value+1),console.log("下一页后页码:",V.value)},100)):console.log("下一页按钮被禁用，当前页码:",V.value,"总页数:",B.value)},he=e=>{ue&&(ue.display(e),j.value=!1,V.value=1)},we=()=>{ue&&(ue.on("relocated",e=>{if(console.log("页面变化:",e),e&&e.start&&e.start.location){const t=e.start.location;V.value=t>0?t:1,console.log("relocated事件更新页码为:",V.value)}else V.value=Math.max(1,V.value),console.log("relocated事件使用默认页码:",V.value)}),ue.on("rendered",e=>{console.log("页面渲染完成:",e),V.value<=0&&(V.value=1,console.log("rendered事件修正页码为:",V.value))}),setTimeout(()=>{V.value<=0&&(V.value=1,console.log("初始化修正页码为:",V.value))},200))},xe=()=>{if(ue&&H.value){const e=H.value.querySelector("iframe");if(e&&e.contentDocument){const t=e.contentDocument.querySelectorAll("style[data-epub-reader]");t.forEach(e=>e.remove());const o=e.contentDocument.createElement("style");o.setAttribute("data-epub-reader","true"),o.textContent=`\n        body {\n          background-color: ${G.value} !important;\n          font-family: ${X.value} !important;\n          font-size: ${Y.value}px !important;\n          line-height: 1.6 !important;\n          color: ${ie.value} !important;\n        }\n        p, div, span, h1, h2, h3, h4, h5, h6 {\n          font-family: ${X.value} !important;\n          font-size: ${Y.value}px !important;\n          color: ${ie.value} !important;\n        }\n        * {\n          font-family: ${X.value} !important;\n        }\n      `,e.contentDocument.head.appendChild(o)}}},_e=()=>{if(ue){console.log("更新字体:",X.value);const e=ue.location;ue.themes.default({body:{"font-family":X.value,"font-size":`${Y.value}px`,"background-color":G.value},p:{"font-family":X.value,"font-size":`${Y.value}px`},div:{"font-family":X.value,"font-size":`${Y.value}px`},span:{"font-family":X.value,"font-size":`${Y.value}px`}}),ue.themes.select("default"),e&&ue.display(e.start.href),setTimeout(()=>{xe()},100)}},ke=()=>{Y.value<24&&(Y.value+=2,console.log("增加字体大小到:",Y.value),Re())},Ee=()=>{Y.value>12&&(Y.value-=2,console.log("减少字体大小到:",Y.value),Re())},Re=()=>{if(ue){console.log("更新字体大小:",Y.value);const e=ue.location;ue.themes.default({body:{"font-family":X.value,"font-size":`${Y.value}px`,"background-color":G.value},p:{"font-family":X.value,"font-size":`${Y.value}px`},div:{"font-family":X.value,"font-size":`${Y.value}px`},span:{"font-family":X.value,"font-size":`${Y.value}px`}}),ue.themes.select("default"),e&&ue.display(e.start.href),setTimeout(()=>{xe()},100)}},Ae=()=>{if(ue){console.log("更新背景:",G.value);const e=ue.location;ue.themes.default({body:{"font-family":X.value,"font-size":`${Y.value}px`,"background-color":G.value},p:{"font-family":X.value,"font-size":`${Y.value}px`},div:{"font-family":X.value,"font-size":`${Y.value}px`},span:{"font-family":X.value,"font-size":`${Y.value}px`}}),ue.themes.select("default"),H.value&&(H.value.style.backgroundColor=G.value),e&&ue.display(e.start.href),setTimeout(()=>{xe()},100)}},Te=()=>{console.log("设置文本选择功能"),ue&&ue.on("selected",async function(e){console.log("epub.js selected事件触发:",e);try{te.value=e;const t=await ce.getRange(e);if(t){const e=t.toString().trim();console.log("选中的文本:",e),e&&(J.value=e,console.log("当前选中内容:",J.value),Ue())}}catch(t){console.error("获取选中文本失败:",t)}}),document.addEventListener("selectionchange",()=>{console.log("选择变化事件触发");const e=window.getSelection();if(console.log("当前选择对象:",e),e&&e.toString().trim()){const t=e.toString().trim();console.log("选中的文本:",t),J.value=t,console.log("当前选中内容:",J.value),Ue()}}),document.addEventListener("mouseup",e=>{console.log("鼠标抬起事件"),oe.value=e.screenX,ne.value=e.screenY,setTimeout(()=>{const e=window.getSelection();if(e&&e.toString().trim()){const t=e.toString().trim();console.log("鼠标选择文本:",t),J.value=t,console.log("当前选中内容:",J.value),Ue()}},100)}),document.addEventListener("mousemove",e=>{oe.value=e.screenX,ne.value=e.screenY})},Ce=(0,l.KR)(!1),Ie=(0,l.KR)(""),Se=(0,l.KR)(re[0].value),Fe=(0,l.KR)(ve[0].value),Le=(0,l.KR)(ie.value),Oe=async()=>{const e=document.getElementById("export-preview-area");if(!e)return;se.value=J.value;const t=e.style.maxHeight,n=e.style.overflowY,l=e.style.width;e.style.maxHeight="none",e.style.overflowY="visible",e.style.width="600px",e.scrollTop=0;try{const t=await o.e(354).then(o.t.bind(o,354,23)),n=await t.default(e,{scale:3,backgroundColor:null,width:600,height:e.scrollHeight}),l=await new Promise(e=>n.toBlob(e));await navigator.clipboard.write([new window.ClipboardItem({[l.type]:l})]),a.nk.success("图片已复制到剪贴板！")}catch(r){a.nk.error("复制失败，可能浏览器不支持或未授权")}finally{e.style.maxHeight=t,e.style.overflowY=n,e.style.width=l}};(0,n.wB)(Ce,e=>{e&&(Se.value=re[0].value,Fe.value=ve[0].value,Le.value=ie.value,ze())}),(0,n.wB)([Se,Fe,Le,fe,se],()=>{Ce.value&&ze()});const ze=async()=>{if(!se.value)return;const e=await o.e(354).then(o.t.bind(o,354,23)),t=3,n=420,l=document.createElement("div");l.style.cssText=`\n    position: fixed;\n    top: -9999px;\n    left: -9999px;\n    width: ${n}px;\n    height: 700px;\n    padding: 2.2rem 1.5rem 1.5rem 1.5rem;\n    background: ${Se.value};\n    border-radius: 18px;\n    box-shadow: 0 4px 24px 0 rgba(0,0,0,0.10), 0 1.5px 4px 0 rgba(0,0,0,0.03);\n    font-family: ${Fe.value}, 'FZKai-Z03', '楷体', 'STKaiti', '仿宋', serif;\n    font-size: ${fe.value}px;\n    color: ${Le.value};\n    line-height: 2.2;\n    text-align: left;\n    z-index: -1;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: flex-start;\n    position: relative;\n    box-sizing: border-box;\n    overflow: hidden;\n  `;const r=document.createElement("div");r.innerHTML='<svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><text x="0" y="28" font-size="32" fill="#e6e6e6" font-family="serif">"</text></svg>',r.style.cssText="\n    position: absolute;\n    top: 1.1rem;\n    left: 1.2rem;\n    width: 36px;\n    height: 36px;\n    opacity: 1;\n    pointer-events: none;\n  ",l.appendChild(r);const a=document.createElement("div");a.style.cssText="\n    margin: 0.5rem 0 0.7rem 0;\n    font-weight: 500;\n    word-break: break-all;\n    white-space: pre-wrap;\n    min-height: 120px;\n    width: 100%;\n    text-align: left;\n    flex: 1;\n  ",a.textContent=se.value;const i=document.createElement("div");i.style.cssText="\n    font-size: 0.98rem;\n    font-family: 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif;\n    opacity: 0.85;\n    margin-left: 0.1rem;\n    margin-bottom: 0.2rem;\n    text-align: right;\n    align-self: flex-end;\n    width: 100%;\n    margin-top: 1rem;\n    color: #7ca05b;\n  ",i.textContent=(new Date).toISOString().slice(0,10),l.appendChild(a),l.appendChild(i),document.body.appendChild(l);const u=l.offsetWidth,c=l.offsetHeight,s=await e.default(l,{scale:t,backgroundColor:null,width:u,height:c});document.body.removeChild(l),Ie.value=s.toDataURL()},De=async()=>{J.value&&(se.value=J.value,Ce.value=!0,a.nk.success("图片已生成，可预览和下载"))},Me=()=>{if(J.value){const t={text:J.value,color:ee.value,timestamp:(new Date).toLocaleString(),id:`highlight_${Date.now()}`,cfiRange:te.value};if(q.value.push(t),te.value&&ue)try{ue.annotations.add("highlight",te.value,{color:ee.value}),console.log("添加epub.js高亮:",te.value)}catch(e){console.error("添加epub.js高亮失败:",e)}J.value="",te.value="",window.getSelection&&window.getSelection().removeAllRanges(),a.nk.success("划线添加成功！")}},Ke=()=>{ue&&(ue.destroy(),ue=null),H.value&&(H.value.innerHTML=""),t.value=null,U.value="",N.value="",V.value=1,B.value=1,$.value="",j.value=!1,P.value=[],ce=null,localStorage.removeItem("epub-book-base64")};(0,n.hi)(()=>{ue&&ue.destroy()});const Ue=async()=>{await(0,n.dY)();const e=window.getSelection(),t=document.querySelector(".tooltip-panel"),o=document.querySelector(".reader-view");if(e&&e.rangeCount>0&&t&&o){const n=e.getRangeAt(0),l=n.getBoundingClientRect(),r=o.getBoundingClientRect(),a=t.offsetWidth||320,i=t.offsetHeight||48,u=12;let c=l.left+l.width/2-a/2-r.left;const s=r.bottom-l.bottom;let f;f=s>i+u?l.bottom-r.top+u:l.top-r.top-i-u,c=Math.max(8,Math.min(c,r.width-a-8)),f=Math.max(8,Math.min(f,r.height-i-8)),le.value={left:`${c}px`,top:`${f}px`,position:"absolute"}}};return(e,o)=>{const a=(0,n.g2)("el-icon"),K=(0,n.g2)("el-upload"),q=(0,n.g2)("el-option"),ee=(0,n.g2)("el-select"),te=(0,n.g2)("el-button"),oe=(0,n.g2)("el-color-picker"),ne=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.CE)("div",c,[(0,n.bF)(u.A),(0,n.Lk)("div",s,[t.value?((0,n.uX)(),(0,n.CE)("div",d,[(0,n.Lk)("div",p,[j.value?((0,n.uX)(),(0,n.CE)("div",y,[o[16]||(o[16]=(0,n.Lk)("h4",null,"目录",-1)),(0,n.Lk)("div",m,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(P.value,(e,t)=>((0,n.uX)(),(0,n.CE)("div",{key:t,class:(0,r.C4)(["toc-item",{active:$.value===e.href}]),onClick:t=>he(e.href)},(0,r.v_)(e.label),11,g))),128))])])):(0,n.Q3)("",!0),Q.value?((0,n.uX)(),(0,n.CE)("div",b,[o[22]||(o[22]=(0,n.Lk)("h4",null,"阅读设置",-1)),(0,n.Lk)("div",h,[o[17]||(o[17]=(0,n.Lk)("label",null,"字体：",-1)),(0,n.bF)(ee,{modelValue:X.value,"onUpdate:modelValue":o[0]||(o[0]=e=>X.value=e),onChange:_e,size:"small"},{default:(0,n.k6)(()=>[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(ve,e=>(0,n.bF)(q,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),(0,n.Lk)("div",w,[o[20]||(o[20]=(0,n.Lk)("label",null,"字体大小：",-1)),(0,n.Lk)("div",x,[(0,n.bF)(te,{onClick:Ee,size:"small"},{default:(0,n.k6)(()=>o[18]||(o[18]=[(0,n.eW)("A-")])),_:1,__:[18]}),(0,n.Lk)("span",_,(0,r.v_)(Y.value)+"px",1),(0,n.bF)(te,{onClick:ke,size:"small"},{default:(0,n.k6)(()=>o[19]||(o[19]=[(0,n.eW)("A+")])),_:1,__:[19]})])]),(0,n.Lk)("div",k,[o[21]||(o[21]=(0,n.Lk)("label",null,"背景：",-1)),(0,n.bF)(ee,{modelValue:G.value,"onUpdate:modelValue":o[1]||(o[1]=e=>G.value=e),onChange:Ae,size:"small"},{default:(0,n.k6)(()=>[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(re,e=>(0,n.bF)(q,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])])):(0,n.Q3)("",!0),(0,n.Lk)("div",{class:"reader-view",ref_key:"readerView",ref:W},[(0,n.Lk)("div",{ref_key:"viewerElement",ref:H,class:"epub-viewer"},null,512),J.value?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"tooltip-panel",style:(0,r.Tr)(le.value)},[(0,n.Lk)("div",E,[(0,n.Lk)("div",R,[(0,n.bF)(te,{onClick:Me,type:"primary",size:"small"},{default:(0,n.k6)(()=>[(0,n.bF)(a,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,l.R1)(i.Edit))]),_:1}),o[23]||(o[23]=(0,n.eW)(" 添加划线 "))]),_:1,__:[23]}),(0,n.bF)(te,{onClick:De,type:"success",size:"small"},{default:(0,n.k6)(()=>[(0,n.bF)(a,null,{default:(0,n.k6)(()=>o[24]||(o[24]=[(0,n.Lk)("picture",null,null,-1)])),_:1,__:[24]}),o[25]||(o[25]=(0,n.eW)(" 导出图片 "))]),_:1,__:[25]})])]),o[26]||(o[26]=(0,n.Lk)("div",{class:"tooltip-arrow"},null,-1))],4)):(0,n.Q3)("",!0)],512),(0,n.Lk)("div",A,[(0,n.Lk)("div",T,[(0,n.Lk)("h3",null,(0,r.v_)(U.value),1),N.value?((0,n.uX)(),(0,n.CE)("p",C,"作者: "+(0,r.v_)(N.value),1)):(0,n.Q3)("",!0)]),(0,n.Lk)("div",I,[(0,n.Lk)("span",null,(0,r.v_)(V.value)+" / "+(0,r.v_)(B.value),1)]),(0,n.Lk)("div",S,[(0,n.bF)(te,{onClick:ge,disabled:V.value<=1,size:"small"},{default:(0,n.k6)(()=>[(0,n.bF)(a,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,l.R1)(i.ArrowLeft))]),_:1}),o[27]||(o[27]=(0,n.eW)(" 上一页 "))]),_:1,__:[27]},8,["disabled"]),(0,n.bF)(te,{onClick:be,disabled:V.value>=B.value,size:"small"},{default:(0,n.k6)(()=>[o[28]||(o[28]=(0,n.eW)(" 下一页 ")),(0,n.bF)(a,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,l.R1)(i.ArrowRight))]),_:1})]),_:1,__:[28]},8,["disabled"]),(0,n.bF)(te,{onClick:o[2]||(o[2]=e=>j.value=!j.value),size:"small"},{default:(0,n.k6)(()=>[(0,n.bF)(a,null,{default:(0,n.k6)(()=>o[29]||(o[29]=[(0,n.Lk)("menu",null,null,-1)])),_:1,__:[29]}),o[30]||(o[30]=(0,n.eW)(" 目录 "))]),_:1,__:[30]}),(0,n.bF)(te,{onClick:o[3]||(o[3]=e=>Q.value=!Q.value),size:"small"},{default:(0,n.k6)(()=>[(0,n.bF)(a,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,l.R1)(i.Setting))]),_:1}),o[31]||(o[31]=(0,n.eW)(" 设置 "))]),_:1,__:[31]}),(0,n.bF)(te,{onClick:o[4]||(o[4]=e=>Z.value=!Z.value),size:"small"},{default:(0,n.k6)(()=>[(0,n.bF)(a,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,l.R1)(i.Edit))]),_:1}),o[32]||(o[32]=(0,n.eW)(" 划线 "))]),_:1,__:[32]}),(0,n.bF)(te,{onClick:Ke,size:"small"},{default:(0,n.k6)(()=>[(0,n.bF)(a,null,{default:(0,n.k6)(()=>[(0,n.bF)((0,l.R1)(i.Refresh))]),_:1}),o[33]||(o[33]=(0,n.eW)(" 重新上传 "))]),_:1,__:[33]})])])])])):((0,n.uX)(),(0,n.CE)("div",f,[(0,n.Lk)("div",v,[o[14]||(o[14]=(0,n.Lk)("h2",null,"EPUB 在线阅读器",-1)),o[15]||(o[15]=(0,n.Lk)("p",null,"上传您的EPUB文件开始阅读",-1)),(0,n.bF)(K,{class:"upload-area",drag:"",accept:".epub","auto-upload":!1,"show-file-list":!1,"on-change":ye},{tip:(0,n.k6)(()=>o[12]||(o[12]=[(0,n.Lk)("div",{class:"el-upload__tip"}," 只能上传 epub 文件 ",-1)])),default:(0,n.k6)(()=>[(0,n.bF)(a,{class:"el-icon--upload"},{default:(0,n.k6)(()=>[(0,n.bF)((0,l.R1)(i.UploadFilled))]),_:1}),o[13]||(o[13]=(0,n.Lk)("div",{class:"el-upload__text"},[(0,n.eW)(" 将文件拖到此处，或"),(0,n.Lk)("em",null,"点击上传")],-1))]),_:1,__:[13]})])]))]),(0,n.bF)(ne,{modelValue:Ce.value,"onUpdate:modelValue":o[11]||(o[11]=e=>Ce.value=e),title:"图片预览",width:"700px",center:""},{footer:(0,n.k6)(()=>[(0,n.bF)(te,{onClick:o[10]||(o[10]=e=>Ce.value=!1)},{default:(0,n.k6)(()=>o[36]||(o[36]=[(0,n.eW)("关闭")])),_:1,__:[36]}),(0,n.bF)(te,{type:"primary",onClick:Oe},{default:(0,n.k6)(()=>o[37]||(o[37]=[(0,n.eW)("复制图片")])),_:1,__:[37]})]),default:(0,n.k6)(()=>[(0,n.Lk)("div",F,[(0,n.Lk)("div",L,[(0,n.Lk)("div",O,[(0,n.Lk)("div",{id:"export-preview-area",style:(0,r.Tr)({width:"420px",minHeight:"120px",maxHeight:"700px",background:Se.value,color:Le.value,fontFamily:Fe.value,fontSize:fe.value+"px",borderRadius:"8px",padding:"2.2rem 1.5rem 1.5rem 1.5rem",boxShadow:"0 4px 24px 0 rgba(0,0,0,0.10), 0 1.5px 4px 0 rgba(0,0,0,0.03)",lineHeight:2.2,textAlign:"left",overflowY:"auto",wordBreak:"break-all",whiteSpace:"pre-wrap",display:"block",boxSizing:"border-box",userSelect:"auto",cursor:"text"})},(0,r.v_)(se.value),5)])]),(0,n.Lk)("div",z,[(0,n.bF)(ee,{modelValue:Fe.value,"onUpdate:modelValue":o[5]||(o[5]=e=>Fe.value=e),placeholder:"字体",size:"small"},{default:(0,n.k6)(()=>[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(ve,e=>(0,n.bF)(q,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),(0,n.Lk)("div",D,[(0,n.bF)(te,{onClick:o[6]||(o[6]=e=>{fe.value=Math.max(12,fe.value-2),ze()}),size:"small"},{default:(0,n.k6)(()=>o[34]||(o[34]=[(0,n.eW)("A-")])),_:1,__:[34]}),(0,n.Lk)("span",M,(0,r.v_)(fe.value)+"px",1),(0,n.bF)(te,{onClick:o[7]||(o[7]=e=>{fe.value=Math.min(36,fe.value+2),ze()}),size:"small"},{default:(0,n.k6)(()=>o[35]||(o[35]=[(0,n.eW)("A+")])),_:1,__:[35]})]),(0,n.bF)(ee,{modelValue:Se.value,"onUpdate:modelValue":o[8]||(o[8]=e=>Se.value=e),placeholder:"背景",size:"small"},{default:(0,n.k6)(()=>[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(re,e=>(0,n.bF)(q,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),(0,n.bF)(oe,{modelValue:Le.value,"onUpdate:modelValue":o[9]||(o[9]=e=>Le.value=e),size:"small"},null,8,["modelValue"])])])]),_:1},8,["modelValue"])])}}},N=o(6262);const V=(0,N.A)(U,[["__scopeId","data-v-25e5c810"]]);var B=V},9539:function(e,t,o){var n=o(9565),l=o(8551),r=o(5966);e.exports=function(e,t,o){var a,i;l(e);try{if(a=r(e,"return"),!a){if("throw"===t)throw o;return o}a=n(a,e)}catch(u){i=!0,a=u}if("throw"===t)throw o;if(i)throw a;return l(a),o}},9577:function(e,t,o){var n=o(9928),l=o(4644),r=o(1108),a=o(1291),i=o(5854),u=l.aTypedArray,c=l.getTypedArrayConstructor,s=l.exportTypedArrayMethod,f=function(){try{new Int8Array(1)["with"](2,{valueOf:function(){throw 8}})}catch(e){return 8===e}}(),v=f&&function(){try{new Int8Array(1)["with"](-.5,1)}catch(e){return!0}}();s("with",{with:function(e,t){var o=u(this),l=a(e),s=r(o)?i(t):+t;return n(o,c(o),l,s)}}["with"],!f||v)},9928:function(e,t,o){var n=o(6198),l=o(1291),r=RangeError;e.exports=function(e,t,o,a){var i=n(e),u=l(o),c=u<0?i+u:u;if(c>=i||c<0)throw new r("Incorrect index");for(var s=new t(i),f=0;f<i;f++)s[f]=f===c?a:e[f];return s}}}]);