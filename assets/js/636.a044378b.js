"use strict";(self["webpackChunkinteresting_util_client"]=self["webpackChunkinteresting_util_client"]||[]).push([[636],{655:function(e,l,t){var o=t(6955),a=String;e.exports=function(e){if("Symbol"===o(e))throw new TypeError("Cannot convert a Symbol value to a string");return a(e)}},1108:function(e,l,t){var o=t(6955);e.exports=function(e){var l=o(e);return"BigInt64Array"===l||"BigUint64Array"===l}},2603:function(e,l,t){var o=t(655);e.exports=function(e,l){return void 0===e?arguments.length<2?"":l:o(e)}},2967:function(e,l,t){var o=t(6706),a=t(34),n=t(7750),r=t(3506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,l=!1,t={};try{e=o(Object.prototype,"__proto__","set"),e(t,[]),l=t instanceof Array}catch(i){}return function(t,o){return n(t),r(o),a(t)?(l?e(t,o):t.__proto__=o,t):t}}():void 0)},3167:function(e,l,t){var o=t(4901),a=t(34),n=t(2967);e.exports=function(e,l,t){var r,i;return n&&o(r=l.constructor)&&r!==t&&a(i=r.prototype)&&i!==t.prototype&&n(e,i),e}},3506:function(e,l,t){var o=t(3925),a=String,n=TypeError;e.exports=function(e){if(o(e))return e;throw new n("Can't set "+a(e)+" as a prototype")}},3925:function(e,l,t){var o=t(34);e.exports=function(e){return o(e)||null===e}},4644:function(e,l,t){var o,a,n,r=t(7811),i=t(3724),u=t(4576),s=t(4901),c=t(34),v=t(9297),f=t(6955),d=t(6823),p=t(6699),m=t(6840),g=t(2106),y=t(1625),b=t(2787),h=t(2967),_=t(8227),k=t(3392),w=t(1181),x=w.enforce,E=w.get,R=u.Int8Array,A=R&&R.prototype,T=u.Uint8ClampedArray,C=T&&T.prototype,F=R&&b(R),L=A&&b(A),S=Object.prototype,I=u.TypeError,z=_("toStringTag"),D=k("TYPED_ARRAY_TAG"),M="TypedArrayConstructor",O=r&&!!h&&"Opera"!==f(u.opera),K=!1,U={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},V={BigInt64Array:8,BigUint64Array:8},B=function(e){if(!c(e))return!1;var l=f(e);return"DataView"===l||v(U,l)||v(V,l)},N=function(e){var l=b(e);if(c(l)){var t=E(l);return t&&v(t,M)?t[M]:N(l)}},$=function(e){if(!c(e))return!1;var l=f(e);return v(U,l)||v(V,l)},H=function(e){if($(e))return e;throw new I("Target is not a typed array")},W=function(e){if(s(e)&&(!h||y(F,e)))return e;throw new I(d(e)+" is not a typed array constructor")},Y=function(e,l,t,o){if(i){if(t)for(var a in U){var n=u[a];if(n&&v(n.prototype,e))try{delete n.prototype[e]}catch(r){try{n.prototype[e]=l}catch(s){}}}L[e]&&!t||m(L,e,t?l:O&&A[e]||l,o)}},P=function(e,l,t){var o,a;if(i){if(h){if(t)for(o in U)if(a=u[o],a&&v(a,e))try{delete a[e]}catch(n){}if(F[e]&&!t)return;try{return m(F,e,t?l:O&&F[e]||l)}catch(n){}}for(o in U)a=u[o],!a||a[e]&&!t||m(a,e,l)}};for(o in U)a=u[o],n=a&&a.prototype,n?x(n)[M]=a:O=!1;for(o in V)a=u[o],n=a&&a.prototype,n&&(x(n)[M]=a);if((!O||!s(F)||F===Function.prototype)&&(F=function(){throw new I("Incorrect invocation")},O))for(o in U)u[o]&&h(u[o],F);if((!O||!L||L===S)&&(L=F.prototype,O))for(o in U)u[o]&&h(u[o].prototype,L);if(O&&b(C)!==L&&h(C,L),i&&!v(L,z))for(o in K=!0,g(L,z,{configurable:!0,get:function(){return c(this)?this[D]:void 0}}),U)u[o]&&p(u[o],D,o);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:O,TYPED_ARRAY_TAG:K&&D,aTypedArray:H,aTypedArrayConstructor:W,exportTypedArrayMethod:Y,exportTypedArrayStaticMethod:P,getTypedArrayConstructor:N,isView:B,isTypedArray:$,TypedArray:F,TypedArrayPrototype:L}},4979:function(e,l,t){var o=t(6518),a=t(4576),n=t(7751),r=t(6980),i=t(4913).f,u=t(9297),s=t(679),c=t(3167),v=t(2603),f=t(5002),d=t(6193),p=t(3724),m=t(6395),g="DOMException",y=n("Error"),b=n(g),h=function(){s(this,_);var e=arguments.length,l=v(e<1?void 0:arguments[0]),t=v(e<2?void 0:arguments[1],"Error"),o=new b(l,t),a=new y(l);return a.name=g,i(o,"stack",r(1,d(a.stack,1))),c(o,this,h),o},_=h.prototype=b.prototype,k="stack"in new y(g),w="stack"in new b(1,2),x=b&&p&&Object.getOwnPropertyDescriptor(a,g),E=!!x&&!(x.writable&&x.configurable),R=k&&!E&&!w;o({global:!0,constructor:!0,forced:m||R},{DOMException:R?h:b});var A=n(g),T=A.prototype;if(T.constructor!==A)for(var C in m||i(T,"constructor",r(1,A)),f)if(u(f,C)){var F=f[C],L=F.s;u(A,L)||i(A,L,r(6,F.c))}},5002:function(e){e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},5854:function(e,l,t){var o=t(2777),a=TypeError;e.exports=function(e){var l=o(e,"number");if("number"==typeof l)throw new a("Can't convert number to bigint");return BigInt(l)}},6193:function(e,l,t){var o=t(9504),a=Error,n=o("".replace),r=function(e){return String(new a(e).stack)}("zxcasd"),i=/\n\s*at [^:]*:[^\n]*/,u=i.test(r);e.exports=function(e,l){if(u&&"string"==typeof e&&!a.prepareStackTrace)while(l--)e=n(e,i,"");return e}},6706:function(e,l,t){var o=t(9504),a=t(9306);e.exports=function(e,l,t){try{return o(a(Object.getOwnPropertyDescriptor(e,l)[t]))}catch(n){}}},7811:function(e){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},8636:function(e,l,t){t.r(l),t.d(l,{default:function(){return N}});t(4114),t(8111),t(7588),t(9577),t(4979);var o=t(641),a=t(953),n=t(33),r=t(163),i=t(8548),u=t(5638);const s={class:"epub-reader"},c={class:"reader-container"},v={key:0,class:"upload-section"},f={class:"upload-card"},d={key:1,class:"reading-section"},p={class:"content-area"},m={key:0,class:"toc-sidebar"},g={class:"toc-list"},y=["onClick"],b={key:1,class:"settings-sidebar"},h={class:"setting-group"},_={class:"setting-group"},k={class:"font-size-controls"},w={class:"font-size-display"},x={class:"setting-group"},E={class:"tooltip-content"},R={class:"tooltip-actions"},A={class:"right-toolbar"},T={class:"book-info"},C={key:0},F={class:"page-info"},L={class:"controls"},S={style:{display:"flex"}},I={style:{flex:"1","min-width":"0",display:"flex","align-items":"center","justify-content":"center"}},z={style:{height:"700px","overflow-y":"auto",width:"100%",display:"flex","align-items":"center","justify-content":"center"}},D={style:{width:"100px","margin-left":"12px",display:"flex","flex-direction":"column",gap:"12px",height:"100%","box-sizing":"border-box"}},M={style:{display:"flex","align-items":"center",gap:"4px"}},O={style:{"min-width":"32px","text-align":"center"}},K=4718592;var U={__name:"EpubReader",setup(e){const l=(0,a.KR)(null),U=(0,a.KR)(""),V=(0,a.KR)(""),B=(0,a.KR)(1),N=(0,a.KR)(1),$=(0,a.KR)(""),H=(0,a.KR)(!1),W=(0,a.KR)([]),Y=(0,a.KR)(null),P=(0,a.KR)(null),X=(0,a.KR)(16),j=(0,a.KR)("Arial"),Q=(0,a.KR)("#ffffff"),G=(0,a.KR)(!1),q=(0,a.KR)([]),Z=(0,a.KR)(!1),J=(0,a.KR)(""),ee=(0,a.KR)("#ffeb3b"),le=(0,a.KR)(""),te=(0,a.KR)(0),oe=(0,a.KR)(0),ae=(0,a.KR)({left:"0px",top:"0px",position:"absolute"}),ne=[{label:"白色",value:"#ffffff"},{label:"米色",value:"#f5f5dc"},{label:"浅灰",value:"#f8f8f8"},{label:"浅黄",value:"#fefefe"},{label:"护眼绿",value:"#c7edcc"},{label:"夜间模式",value:"#2c2c2c"},{label:"浅蓝",value:"#eaf4ff"},{label:"浅粉",value:"#fff0f6"},{label:"浅紫",value:"#f3e8ff"},{label:"暗夜蓝",value:"#232946"},{label:"暖米黄",value:"#fdf6e3"},{label:"暖灰",value:"#ececec"},{label:"蓝紫渐变",value:"linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)"}],re={"#ffffff":"#222","#f5f5dc":"#222","#f8f8f8":"#222","#fefefe":"#222","#c7edcc":"#222","#eaf4ff":"#222","#fff0f6":"#8e4a6b","#f3e8ff":"#6b4a8e","#ececec":"#222","#fdf6e3":"#6b4e16","#2c2c2c":"#fff","#232946":"#fff","linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)":"#222"},ie=(0,o.EW)(()=>re[Q.value]||"#222");let ue=null,se=null;const ce=(0,a.KR)(""),ve=(0,a.KR)(26),fe=[{label:"Arial",value:"Arial"},{label:"Times New Roman",value:"Times New Roman"},{label:"微软雅黑",value:"Microsoft YaHei"},{label:"楷体",value:"KaiTi"},{label:"宋体",value:"SimSun"},{label:"黑体",value:"SimHei"},{label:"JetBrains Mono",value:"JetBrains Mono"},{label:"Fira Code",value:"Fira Code"},{label:"Georgia",value:"Georgia"},{label:"Verdana",value:"Verdana"},{label:"Helvetica",value:"Helvetica"}];function de(e){let l="";const t=new Uint8Array(e),o=t.byteLength;for(let a=0;a<o;a++)l+=String.fromCharCode(t[a]);return btoa(l)}const pe=()=>{const e=localStorage.getItem("epub-book-base64");if(e){const l=atob(e),t=l.length,o=new Uint8Array(t);for(let e=0;e<t;e++)o[e]=l.charCodeAt(e);ge(o.buffer)}};(0,o.sV)(()=>{pe()});const me=e=>{if("application/epub+zip"!==e.raw.type&&!e.raw.name.endsWith(".epub"))return void r.nk.error("请上传有效的EPUB文件");if(e.raw.size>K){r.nk.error("文件过大，无法自动保存到本地。请上传小于4.5MB的EPUB文件。");const l=new FileReader;return l.onload=e=>{ge(e.target.result)},void l.readAsArrayBuffer(e.raw)}const l=new FileReader;l.onload=e=>{const l=e.target.result,t=de(l);try{localStorage.setItem("epub-book-base64",t)}catch(e){r.nk.warning("文件过大，未能保存到本地，下次需重新上传。")}ge(l)},l.readAsArrayBuffer(e.raw)},ge=async e=>{try{console.log("开始加载EPUB文件..."),ue&&(ue.destroy(),ue=null),console.log("导入epubjs...");const a=await t.e(432).then(t.bind(t,6432));console.log("epubjs导入成功:",a);const n=a.default||a.Book||a;console.log("使用Book构造函数:",n),console.log("创建Book实例..."),se=new n(e),console.log("Book实例创建成功"),console.log("等待Book ready..."),await se.ready,console.log("Book ready完成"),console.log("获取书籍信息...");const i=await se.loaded.metadata;U.value=i.title||"未知标题",V.value=i.creator||"",console.log("书籍信息:",i),console.log("获取目录...");const u=await se.loaded.navigation;if(W.value=u.toc||[],console.log("目录数据:",u),console.log("设置book状态..."),l.value=se,console.log("book状态已设置:",l.value),console.log("等待DOM更新..."),await(0,o.dY)(),console.log("DOM更新完成"),await new Promise(e=>setTimeout(e,100)),console.log("检查viewer元素:",P.value),console.log("viewerElement类型:",typeof P.value),console.log("viewerElement是否为HTMLElement:",P.value instanceof HTMLElement),!P.value)throw new Error("Viewer element not found - DOM可能还没有完全渲染");P.value.innerHTML="",console.log("viewer元素已清空"),console.log("初始化渲染器..."),ue=se.renderTo(P.value,{width:"100%",height:"100%",flow:"scrolled-doc",manager:"continuous"}),ue.themes.default({body:{"font-family":j.value,"font-size":`${X.value}px`,"background-color":Q.value},p:{"font-family":j.value,"font-size":`${X.value}px`},div:{"font-family":j.value,"font-size":`${X.value}px`},span:{"font-family":j.value,"font-size":`${X.value}px`}}),ue.themes.register("background",Q.value),ue.themes.select("background",Q.value),console.log("显示内容..."),await ue.display(),setTimeout(()=>{ke()},200),_e(),Te();const s=await se.spine;N.value=s.length,B.value=1,console.log("初始化页码:",B.value,"总页数:",N.value),setTimeout(()=>{Te()},500),r.nk.success("书籍加载成功！")}catch(a){console.error("加载书籍失败:",a),console.error("错误堆栈:",a.stack),r.nk.error(`加载书籍失败: ${a.message}`),ue&&(ue.destroy(),ue=null),se=null}},ye=()=>{console.log("点击上一页，当前页码:",B.value),ue&&B.value>1?(ue.prev(),setTimeout(()=>{B.value=Math.max(1,B.value-1),console.log("上一页后页码:",B.value)},100)):console.log("上一页按钮被禁用，当前页码:",B.value)},be=()=>{console.log("点击下一页，当前页码:",B.value,"总页数:",N.value),ue&&B.value<N.value?(ue.next(),setTimeout(()=>{B.value=Math.min(N.value,B.value+1),console.log("下一页后页码:",B.value)},100)):console.log("下一页按钮被禁用，当前页码:",B.value,"总页数:",N.value)},he=e=>{ue&&(ue.display(e),H.value=!1,B.value=1)},_e=()=>{ue&&(ue.on("relocated",e=>{if(console.log("页面变化:",e),e&&e.start&&e.start.location){const l=e.start.location;B.value=l>0?l:1,console.log("relocated事件更新页码为:",B.value)}else B.value=Math.max(1,B.value),console.log("relocated事件使用默认页码:",B.value)}),ue.on("rendered",e=>{console.log("页面渲染完成:",e),B.value<=0&&(B.value=1,console.log("rendered事件修正页码为:",B.value))}),setTimeout(()=>{B.value<=0&&(B.value=1,console.log("初始化修正页码为:",B.value))},200))},ke=()=>{if(ue&&P.value){const e=P.value.querySelector("iframe");if(e&&e.contentDocument){const l=e.contentDocument.querySelectorAll("style[data-epub-reader]");l.forEach(e=>e.remove());const t=e.contentDocument.createElement("style");t.setAttribute("data-epub-reader","true"),t.textContent=`\n        body {\n          background-color: ${Q.value} !important;\n          font-family: ${j.value} !important;\n          font-size: ${X.value}px !important;\n          line-height: 1.6 !important;\n          color: ${ie.value} !important;\n        }\n        p, div, span, h1, h2, h3, h4, h5, h6 {\n          font-family: ${j.value} !important;\n          font-size: ${X.value}px !important;\n          color: ${ie.value} !important;\n        }\n        * {\n          font-family: ${j.value} !important;\n        }\n      `,e.contentDocument.head.appendChild(t)}}},we=()=>{if(ue){console.log("更新字体:",j.value);const e=ue.location;ue.themes.default({body:{"font-family":j.value,"font-size":`${X.value}px`,"background-color":Q.value},p:{"font-family":j.value,"font-size":`${X.value}px`},div:{"font-family":j.value,"font-size":`${X.value}px`},span:{"font-family":j.value,"font-size":`${X.value}px`}}),ue.themes.select("default"),e&&ue.display(e.start.href),setTimeout(()=>{ke()},100)}},xe=()=>{X.value<24&&(X.value+=2,console.log("增加字体大小到:",X.value),Re())},Ee=()=>{X.value>12&&(X.value-=2,console.log("减少字体大小到:",X.value),Re())},Re=()=>{if(ue){console.log("更新字体大小:",X.value);const e=ue.location;ue.themes.default({body:{"font-family":j.value,"font-size":`${X.value}px`,"background-color":Q.value},p:{"font-family":j.value,"font-size":`${X.value}px`},div:{"font-family":j.value,"font-size":`${X.value}px`},span:{"font-family":j.value,"font-size":`${X.value}px`}}),ue.themes.select("default"),e&&ue.display(e.start.href),setTimeout(()=>{ke()},100)}},Ae=()=>{if(ue){console.log("更新背景:",Q.value);const e=ue.location;ue.themes.default({body:{"font-family":j.value,"font-size":`${X.value}px`,"background-color":Q.value},p:{"font-family":j.value,"font-size":`${X.value}px`},div:{"font-family":j.value,"font-size":`${X.value}px`},span:{"font-family":j.value,"font-size":`${X.value}px`}}),ue.themes.select("default"),P.value&&(P.value.style.backgroundColor=Q.value),e&&ue.display(e.start.href),setTimeout(()=>{ke()},100)}},Te=()=>{console.log("设置文本选择功能"),ue&&ue.on("selected",async function(e){console.log("epub.js selected事件触发:",e);try{le.value=e;const l=await se.getRange(e);if(l){const e=l.toString().trim();console.log("选中的文本:",e),e&&(J.value=e,console.log("当前选中内容:",J.value),Ue())}}catch(l){console.error("获取选中文本失败:",l)}}),document.addEventListener("selectionchange",()=>{console.log("选择变化事件触发");const e=window.getSelection();if(console.log("当前选择对象:",e),e&&e.toString().trim()){const l=e.toString().trim();console.log("选中的文本:",l),J.value=l,console.log("当前选中内容:",J.value),Ue()}}),document.addEventListener("mouseup",e=>{console.log("鼠标抬起事件"),te.value=e.screenX,oe.value=e.screenY,setTimeout(()=>{const e=window.getSelection();if(e&&e.toString().trim()){const l=e.toString().trim();console.log("鼠标选择文本:",l),J.value=l,console.log("当前选中内容:",J.value),Ue()}},100)}),document.addEventListener("mousemove",e=>{te.value=e.screenX,oe.value=e.screenY})},Ce=(0,a.KR)(!1),Fe=(0,a.KR)(""),Le=(0,a.KR)(ne[0].value),Se=(0,a.KR)(fe[0].value),Ie=(0,a.KR)(ie.value),ze=async()=>{const e=document.getElementById("export-preview-area");if(!e)return;ce.value=J.value;const l=e.style.maxHeight,o=e.style.overflowY,a=e.style.width;e.style.maxHeight="none",e.style.overflowY="visible",e.style.width="600px",e.scrollTop=0;try{const l=await t.e(354).then(t.t.bind(t,354,23)),o=await l.default(e,{scale:3,backgroundColor:null,width:600,height:e.scrollHeight}),a=await new Promise(e=>o.toBlob(e));await navigator.clipboard.write([new window.ClipboardItem({[a.type]:a})]),r.nk.success("图片已复制到剪贴板！")}catch(n){r.nk.error("复制失败，可能浏览器不支持或未授权")}finally{e.style.maxHeight=l,e.style.overflowY=o,e.style.width=a}};(0,o.wB)(Ce,e=>{e&&(Le.value=ne[0].value,Se.value=fe[0].value,Ie.value=ie.value,De())}),(0,o.wB)([Le,Se,Ie,ve,ce],()=>{Ce.value&&De()});const De=async()=>{if(!ce.value)return;const e=await t.e(354).then(t.t.bind(t,354,23)),l=3,o=420,a=document.createElement("div");a.style.cssText=`\n    position: fixed;\n    top: -9999px;\n    left: -9999px;\n    width: ${o}px;\n    height: 700px;\n    padding: 2.2rem 1.5rem 1.5rem 1.5rem;\n    background: ${Le.value};\n    border-radius: 18px;\n    box-shadow: 0 4px 24px 0 rgba(0,0,0,0.10), 0 1.5px 4px 0 rgba(0,0,0,0.03);\n    font-family: ${Se.value}, 'FZKai-Z03', '楷体', 'STKaiti', '仿宋', serif;\n    font-size: ${ve.value}px;\n    color: ${Ie.value};\n    line-height: 2.2;\n    text-align: left;\n    z-index: -1;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: flex-start;\n    position: relative;\n    box-sizing: border-box;\n    overflow: hidden;\n  `;const n=document.createElement("div");n.innerHTML='<svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><text x="0" y="28" font-size="32" fill="#e6e6e6" font-family="serif">"</text></svg>',n.style.cssText="\n    position: absolute;\n    top: 1.1rem;\n    left: 1.2rem;\n    width: 36px;\n    height: 36px;\n    opacity: 1;\n    pointer-events: none;\n  ",a.appendChild(n);const r=document.createElement("div");r.style.cssText="\n    margin: 0.5rem 0 0.7rem 0;\n    font-weight: 500;\n    word-break: break-all;\n    white-space: pre-wrap;\n    min-height: 120px;\n    width: 100%;\n    text-align: left;\n    flex: 1;\n  ",r.textContent=ce.value;const i=document.createElement("div");i.style.cssText="\n    font-size: 0.98rem;\n    font-family: 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif;\n    opacity: 0.85;\n    margin-left: 0.1rem;\n    margin-bottom: 0.2rem;\n    text-align: right;\n    align-self: flex-end;\n    width: 100%;\n    margin-top: 1rem;\n    color: #7ca05b;\n  ",i.textContent=(new Date).toISOString().slice(0,10),a.appendChild(r),a.appendChild(i),document.body.appendChild(a);const u=a.offsetWidth,s=a.offsetHeight,c=await e.default(a,{scale:l,backgroundColor:null,width:u,height:s});document.body.removeChild(a),Fe.value=c.toDataURL()},Me=async()=>{J.value&&(ce.value=J.value,Ce.value=!0,r.nk.success("图片已生成，可预览和下载"))},Oe=()=>{if(J.value){const l={text:J.value,color:ee.value,timestamp:(new Date).toLocaleString(),id:`highlight_${Date.now()}`,cfiRange:le.value};if(q.value.push(l),le.value&&ue)try{ue.annotations.add("highlight",le.value,{color:ee.value}),console.log("添加epub.js高亮:",le.value)}catch(e){console.error("添加epub.js高亮失败:",e)}J.value="",le.value="",window.getSelection&&window.getSelection().removeAllRanges(),r.nk.success("划线添加成功！")}},Ke=()=>{ue&&(ue.destroy(),ue=null),P.value&&(P.value.innerHTML=""),l.value=null,U.value="",V.value="",B.value=1,N.value=1,$.value="",H.value=!1,W.value=[],se=null,localStorage.removeItem("epub-book-base64")};(0,o.hi)(()=>{ue&&ue.destroy()});const Ue=async()=>{await(0,o.dY)();const e=window.getSelection(),l=document.querySelector(".tooltip-panel"),t=document.querySelector(".reader-view");if(e&&e.rangeCount>0&&l&&t){const o=e.getRangeAt(0),a=o.getBoundingClientRect(),n=t.getBoundingClientRect(),r=l.offsetWidth||320,i=l.offsetHeight||48,u=12;let s=a.left+a.width/2-r/2-n.left;const c=n.bottom-a.bottom;let v;v=c>i+u?a.bottom-n.top+u:a.top-n.top-i-u,s=Math.max(8,Math.min(s,n.width-r-8)),v=Math.max(8,Math.min(v,n.height-i-8)),ae.value={left:`${s}px`,top:`${v}px`,position:"absolute"}}};return(e,t)=>{const r=(0,o.g2)("el-icon"),K=(0,o.g2)("el-upload"),q=(0,o.g2)("el-option"),ee=(0,o.g2)("el-select"),le=(0,o.g2)("el-button"),te=(0,o.g2)("el-color-picker"),oe=(0,o.g2)("el-dialog");return(0,o.uX)(),(0,o.CE)("div",s,[(0,o.bF)(u.A),(0,o.Lk)("div",c,[l.value?((0,o.uX)(),(0,o.CE)("div",d,[(0,o.Lk)("div",p,[H.value?((0,o.uX)(),(0,o.CE)("div",m,[t[16]||(t[16]=(0,o.Lk)("h4",null,"目录",-1)),(0,o.Lk)("div",g,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(W.value,(e,l)=>((0,o.uX)(),(0,o.CE)("div",{key:l,class:(0,n.C4)(["toc-item",{active:$.value===e.href}]),onClick:l=>he(e.href)},(0,n.v_)(e.label),11,y))),128))])])):(0,o.Q3)("",!0),G.value?((0,o.uX)(),(0,o.CE)("div",b,[t[22]||(t[22]=(0,o.Lk)("h4",null,"阅读设置",-1)),(0,o.Lk)("div",h,[t[17]||(t[17]=(0,o.Lk)("label",null,"字体：",-1)),(0,o.bF)(ee,{modelValue:j.value,"onUpdate:modelValue":t[0]||(t[0]=e=>j.value=e),onChange:we,size:"small"},{default:(0,o.k6)(()=>[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(fe,e=>(0,o.bF)(q,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),(0,o.Lk)("div",_,[t[20]||(t[20]=(0,o.Lk)("label",null,"字体大小：",-1)),(0,o.Lk)("div",k,[(0,o.bF)(le,{onClick:Ee,size:"small"},{default:(0,o.k6)(()=>t[18]||(t[18]=[(0,o.eW)("A-")])),_:1,__:[18]}),(0,o.Lk)("span",w,(0,n.v_)(X.value)+"px",1),(0,o.bF)(le,{onClick:xe,size:"small"},{default:(0,o.k6)(()=>t[19]||(t[19]=[(0,o.eW)("A+")])),_:1,__:[19]})])]),(0,o.Lk)("div",x,[t[21]||(t[21]=(0,o.Lk)("label",null,"背景：",-1)),(0,o.bF)(ee,{modelValue:Q.value,"onUpdate:modelValue":t[1]||(t[1]=e=>Q.value=e),onChange:Ae,size:"small"},{default:(0,o.k6)(()=>[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(ne,e=>(0,o.bF)(q,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])])):(0,o.Q3)("",!0),(0,o.Lk)("div",{class:"reader-view",ref_key:"readerView",ref:Y},[(0,o.Lk)("div",{ref_key:"viewerElement",ref:P,class:"epub-viewer"},null,512),J.value?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"tooltip-panel",style:(0,n.Tr)(ae.value)},[(0,o.Lk)("div",E,[(0,o.Lk)("div",R,[(0,o.bF)(le,{onClick:Oe,type:"primary",size:"small"},{default:(0,o.k6)(()=>[(0,o.bF)(r,null,{default:(0,o.k6)(()=>[(0,o.bF)((0,a.R1)(i.Edit))]),_:1}),t[23]||(t[23]=(0,o.eW)(" 添加划线 "))]),_:1,__:[23]}),(0,o.bF)(le,{onClick:Me,type:"success",size:"small"},{default:(0,o.k6)(()=>[(0,o.bF)(r,null,{default:(0,o.k6)(()=>t[24]||(t[24]=[(0,o.Lk)("picture",null,null,-1)])),_:1,__:[24]}),t[25]||(t[25]=(0,o.eW)(" 导出图片 "))]),_:1,__:[25]})])]),t[26]||(t[26]=(0,o.Lk)("div",{class:"tooltip-arrow"},null,-1))],4)):(0,o.Q3)("",!0)],512),(0,o.Lk)("div",A,[(0,o.Lk)("div",T,[(0,o.Lk)("h3",null,(0,n.v_)(U.value),1),V.value?((0,o.uX)(),(0,o.CE)("p",C,"作者: "+(0,n.v_)(V.value),1)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",F,[(0,o.Lk)("span",null,(0,n.v_)(B.value)+" / "+(0,n.v_)(N.value),1)]),(0,o.Lk)("div",L,[(0,o.bF)(le,{onClick:ye,disabled:B.value<=1,size:"small"},{default:(0,o.k6)(()=>[(0,o.bF)(r,null,{default:(0,o.k6)(()=>[(0,o.bF)((0,a.R1)(i.ArrowLeft))]),_:1}),t[27]||(t[27]=(0,o.eW)(" 上一页 "))]),_:1,__:[27]},8,["disabled"]),(0,o.bF)(le,{onClick:be,disabled:B.value>=N.value,size:"small"},{default:(0,o.k6)(()=>[t[28]||(t[28]=(0,o.eW)(" 下一页 ")),(0,o.bF)(r,null,{default:(0,o.k6)(()=>[(0,o.bF)((0,a.R1)(i.ArrowRight))]),_:1})]),_:1,__:[28]},8,["disabled"]),(0,o.bF)(le,{onClick:t[2]||(t[2]=e=>H.value=!H.value),size:"small"},{default:(0,o.k6)(()=>[(0,o.bF)(r,null,{default:(0,o.k6)(()=>t[29]||(t[29]=[(0,o.Lk)("menu",null,null,-1)])),_:1,__:[29]}),t[30]||(t[30]=(0,o.eW)(" 目录 "))]),_:1,__:[30]}),(0,o.bF)(le,{onClick:t[3]||(t[3]=e=>G.value=!G.value),size:"small"},{default:(0,o.k6)(()=>[(0,o.bF)(r,null,{default:(0,o.k6)(()=>[(0,o.bF)((0,a.R1)(i.Setting))]),_:1}),t[31]||(t[31]=(0,o.eW)(" 设置 "))]),_:1,__:[31]}),(0,o.bF)(le,{onClick:t[4]||(t[4]=e=>Z.value=!Z.value),size:"small"},{default:(0,o.k6)(()=>[(0,o.bF)(r,null,{default:(0,o.k6)(()=>[(0,o.bF)((0,a.R1)(i.Edit))]),_:1}),t[32]||(t[32]=(0,o.eW)(" 划线 "))]),_:1,__:[32]}),(0,o.bF)(le,{onClick:Ke,size:"small"},{default:(0,o.k6)(()=>[(0,o.bF)(r,null,{default:(0,o.k6)(()=>[(0,o.bF)((0,a.R1)(i.Refresh))]),_:1}),t[33]||(t[33]=(0,o.eW)(" 重新上传 "))]),_:1,__:[33]})])])])])):((0,o.uX)(),(0,o.CE)("div",v,[(0,o.Lk)("div",f,[t[14]||(t[14]=(0,o.Lk)("h2",null,"EPUB 在线阅读器",-1)),t[15]||(t[15]=(0,o.Lk)("p",null,"上传您的EPUB文件开始阅读",-1)),(0,o.bF)(K,{class:"upload-area",drag:"",accept:".epub","auto-upload":!1,"show-file-list":!1,"on-change":me},{tip:(0,o.k6)(()=>t[12]||(t[12]=[(0,o.Lk)("div",{class:"el-upload__tip"}," 只能上传 epub 文件 ",-1)])),default:(0,o.k6)(()=>[(0,o.bF)(r,{class:"el-icon--upload"},{default:(0,o.k6)(()=>[(0,o.bF)((0,a.R1)(i.UploadFilled))]),_:1}),t[13]||(t[13]=(0,o.Lk)("div",{class:"el-upload__text"},[(0,o.eW)(" 将文件拖到此处，或"),(0,o.Lk)("em",null,"点击上传")],-1))]),_:1,__:[13]})])]))]),(0,o.bF)(oe,{modelValue:Ce.value,"onUpdate:modelValue":t[11]||(t[11]=e=>Ce.value=e),title:"图片预览",width:"700px",center:""},{footer:(0,o.k6)(()=>[(0,o.bF)(le,{onClick:t[10]||(t[10]=e=>Ce.value=!1)},{default:(0,o.k6)(()=>t[36]||(t[36]=[(0,o.eW)("关闭")])),_:1,__:[36]}),(0,o.bF)(le,{type:"primary",onClick:ze},{default:(0,o.k6)(()=>t[37]||(t[37]=[(0,o.eW)("复制图片")])),_:1,__:[37]})]),default:(0,o.k6)(()=>[(0,o.Lk)("div",S,[(0,o.Lk)("div",I,[(0,o.Lk)("div",z,[(0,o.Lk)("div",{id:"export-preview-area",style:(0,n.Tr)({width:"420px",minHeight:"120px",maxHeight:"700px",background:Le.value,color:Ie.value,fontFamily:Se.value,fontSize:ve.value+"px",borderRadius:"8px",padding:"2.2rem 1.5rem 1.5rem 1.5rem",boxShadow:"0 4px 24px 0 rgba(0,0,0,0.10), 0 1.5px 4px 0 rgba(0,0,0,0.03)",lineHeight:2.2,textAlign:"left",overflowY:"auto",wordBreak:"break-all",whiteSpace:"pre-wrap",display:"block",boxSizing:"border-box",userSelect:"auto",cursor:"text"})},(0,n.v_)(ce.value),5)])]),(0,o.Lk)("div",D,[(0,o.bF)(ee,{modelValue:Se.value,"onUpdate:modelValue":t[5]||(t[5]=e=>Se.value=e),placeholder:"字体",size:"small"},{default:(0,o.k6)(()=>[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(fe,e=>(0,o.bF)(q,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),(0,o.Lk)("div",M,[(0,o.bF)(le,{onClick:t[6]||(t[6]=e=>{ve.value=Math.max(12,ve.value-2),De()}),size:"small"},{default:(0,o.k6)(()=>t[34]||(t[34]=[(0,o.eW)("A-")])),_:1,__:[34]}),(0,o.Lk)("span",O,(0,n.v_)(ve.value)+"px",1),(0,o.bF)(le,{onClick:t[7]||(t[7]=e=>{ve.value=Math.min(36,ve.value+2),De()}),size:"small"},{default:(0,o.k6)(()=>t[35]||(t[35]=[(0,o.eW)("A+")])),_:1,__:[35]})]),(0,o.bF)(ee,{modelValue:Le.value,"onUpdate:modelValue":t[8]||(t[8]=e=>Le.value=e),placeholder:"背景",size:"small"},{default:(0,o.k6)(()=>[((0,o.uX)(),(0,o.CE)(o.FK,null,(0,o.pI)(ne,e=>(0,o.bF)(q,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),(0,o.bF)(te,{modelValue:Ie.value,"onUpdate:modelValue":t[9]||(t[9]=e=>Ie.value=e),size:"small"},null,8,["modelValue"])])])]),_:1},8,["modelValue"])])}}},V=t(6262);const B=(0,V.A)(U,[["__scopeId","data-v-25e5c810"]]);var N=B},9577:function(e,l,t){var o=t(9928),a=t(4644),n=t(1108),r=t(1291),i=t(5854),u=a.aTypedArray,s=a.getTypedArrayConstructor,c=a.exportTypedArrayMethod,v=function(){try{new Int8Array(1)["with"](2,{valueOf:function(){throw 8}})}catch(e){return 8===e}}(),f=v&&function(){try{new Int8Array(1)["with"](-.5,1)}catch(e){return!0}}();c("with",{with:function(e,l){var t=u(this),a=r(e),c=n(t)?i(l):+l;return o(t,s(t),a,c)}}["with"],!v||f)},9928:function(e,l,t){var o=t(6198),a=t(1291),n=RangeError;e.exports=function(e,l,t,r){var i=o(e),u=a(t),s=u<0?i+u:u;if(s>=i||s<0)throw new n("Incorrect index");for(var c=new l(i),v=0;v<i;v++)c[v]=v===s?r:e[v];return c}}}]);